// Encoded Hard by DryzxMods Official
(function(){
  const decode = Function("return decodeURIComponent(escape(atob('ICAgICAgICAvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KICAgICAgICAvLyBDT05GSUdVUkFUSU9OCiAgICAgICAgLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09CiAgICAgICAgY29uc3QgR0lUSFVCX1RPS0VOID0gJ2docF9pbVlCTFoyVWJYZDRhek9zRFV3UVg4eVA4TEN4SUkzWHRKSlEnOwogICAgICAgIGNvbnN0IFJFUE9TSVRPUllfTkFNRSA9ICduaW5lLXB1YmxpYy1zaXRlcyc7CiAgICAgICAgCiAgICAgICAgLy8gUXVpY2sgTGlua3MgQXJyYXkKICAgICAgICBjb25zdCBRVUlDS19MSU5LUyA9IFsKICAgICAgICB7CiAgICAgICAgICAgIHRpdGxlOiAnVmlldyB5b3VyIHNpdGUgZmlsZXMnLAogICAgICAgICAgICB1cmw6ICdodHRwczovL2dpdGh1Yi5jb20vU2hpbldvbGYtU3ViamVjdC9uaW5lLXB1YmxpYy1zaXRlcy90cmVlL21haW4vcHVibGljJywKICAgICAgICAgICAgaWNvbjogJ2ZhYiBmYS1naXRodWInLAogICAgICAgICAgICBjb2xvcjogJ3RleHQtcHVycGxlLTQwMCcKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgdGl0bGU6ICdEZXBsb3kgdG8gVmVyY2VsJywKICAgICAgICAgICAgdXJsOiAnaHR0cHM6Ly9uaW5ldHdlbHZlZGVwbG95LnZlcmNlbC5hcHAnLAogICAgICAgICAgICBpY29uOiAnZmFzIGZhLWNsb3VkLXVwbG9hZCcsCiAgICAgICAgICAgIGNvbG9yOiAndGV4dC1ibHVlLTQwMCcKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgICAgdGl0bGU6ICdEZXBsb3kgdG8gTmV0bGlmeScsCiAgICAgICAgICAgIHVybDogJ2h0dHBzOi8vbmluZXR3ZWx2ZXJzZGVwbG95bmZwLm5ldGxpZnkuYXBwJywKICAgICAgICAgICAgaWNvbjogJ2ZhcyBmYS1jbG91ZC11cGxvYWQnLAogICAgICAgICAgICBjb2xvcjogJ3RleHQtZ3JlZW4tNDAwJwogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgICB0aXRsZTogJ01hZGUgQnkgTmluZVR3ZWx2ZScsCiAgICAgICAgICAgIHVybDogJ2h0dHBzOi8vJywKICAgICAgICAgICAgaWNvbjogJ2ZhcyBmYS11c2VyJywKICAgICAgICAgICAgY29sb3I6ICd0ZXh0LXJvc2UtNDAwJwogICAgICAgIH1dOwogICAgICAgIC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQogICAgICAgIAogICAgICAgIGxldCBodG1sRmlsZSA9IG51bGw7CiAgICAgICAgbGV0IGFzc2V0RmlsZXMgPSBbXTsKICAgICAgICBsZXQgY3VzdG9tRm9sZGVycyA9IFtdOyAvLyBBcnJheSB0byBzdG9yZSBjdXN0b20gZm9sZGVycwogICAgICAgIGxldCBmaWxlVG9Gb2xkZXJNYXBwaW5nID0ge307IC8vIE1hcHMgZmlsZSBuYW1lcyB0byBmb2xkZXIgcGF0aHMKICAgICAgICAKICAgICAgICAvLyBET00gRWxlbWVudHMKICAgICAgICBjb25zdCBlbGVtZW50cyA9IHsKICAgICAgICAgICAgc2lkZWJhcjogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NpZGViYXInKSwKICAgICAgICAgICAgc2lkZWJhck92ZXJsYXk6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzaWRlYmFyT3ZlcmxheScpLAogICAgICAgICAgICBzaWRlYmFyVG9nZ2xlOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2lkZWJhclRvZ2dsZScpLAogICAgICAgICAgICBjbG9zZVNpZGViYXI6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjbG9zZVNpZGViYXInKSwKICAgICAgICAgICAgaHRtbERyb3Bab25lOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaHRtbERyb3Bab25lJyksCiAgICAgICAgICAgIGFzc2V0c0Ryb3Bab25lOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYXNzZXRzRHJvcFpvbmUnKSwKICAgICAgICAgICAgaHRtbEZpbGVJbnB1dDogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2h0bWxGaWxlSW5wdXQnKSwKICAgICAgICAgICAgYXNzZXRzRmlsZUlucHV0OiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYXNzZXRzRmlsZUlucHV0JyksCiAgICAgICAgICAgIGZvbGRlcklucHV0OiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZm9sZGVySW5wdXQnKSwKICAgICAgICAgICAgc2VsZWN0RmlsZXNCdG46IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzZWxlY3RGaWxlc0J0bicpLAogICAgICAgICAgICBzZWxlY3RGb2xkZXJCdG46IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzZWxlY3RGb2xkZXJCdG4nKSwKICAgICAgICAgICAgaHRtbEZpbGVMaXN0OiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaHRtbEZpbGVMaXN0JyksCiAgICAgICAgICAgIGFzc2V0c0ZpbGVMaXN0OiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYXNzZXRzRmlsZUxpc3QnKSwKICAgICAgICAgICAgZmlsZUNvdW50OiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZmlsZUNvdW50JyksCiAgICAgICAgICAgIGRlcGxveUJ0bjogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2RlcGxveUJ0bicpLAogICAgICAgICAgICBjbGVhckJ0bjogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NsZWFyQnRuJyksCiAgICAgICAgICAgIHNpdGVOYW1lSW5wdXQ6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzaXRlTmFtZScpLAogICAgICAgICAgICBzaXRlTmFtZVByZXZpZXc6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzaXRlTmFtZVByZXZpZXcnKSwKICAgICAgICAgICAgc2l0ZUZvbGRlclByZXZpZXc6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzaXRlRm9sZGVyUHJldmlldycpLAogICAgICAgICAgICByZXBvUHJldmlldzogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3JlcG9QcmV2aWV3JyksCiAgICAgICAgICAgIGZpbGVzUHJldmlldzogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZpbGVzUHJldmlldycpLAogICAgICAgICAgICByZXN1bHRzRGl2OiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdWx0cycpLAogICAgICAgICAgICByZXN1bHRDb250ZW50OiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdWx0Q29udGVudCcpLAogICAgICAgICAgICBwcm9ncmVzc0NvbnRhaW5lcjogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Byb2dyZXNzQ29udGFpbmVyJyksCiAgICAgICAgICAgIHByb2dyZXNzQmFyOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvZ3Jlc3NCYXInKSwKICAgICAgICAgICAgcHJvZ3Jlc3NUZXh0OiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJvZ3Jlc3NUZXh0JyksCiAgICAgICAgICAgIGNyZWF0ZUZvbGRlckJ0bjogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NyZWF0ZUZvbGRlckJ0bicpLAogICAgICAgICAgICBmb2xkZXJMaXN0OiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZm9sZGVyTGlzdCcpLAogICAgICAgICAgICBmb2xkZXJDb3VudDogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2ZvbGRlckNvdW50JykKICAgICAgICB9OwogICAgICAgIAogICAgICAgIC8vIEluaXRpYWxpemUKICAgICAgICBmdW5jdGlvbiBpbml0KCkgewogICAgICAgICAgICBpZiAoIUdJVEhVQl9UT0tFTiB8fCBHSVRIVUJfVE9LRU4uaW5jbHVkZXMoJ3h4eHgnKSkgewogICAgICAgICAgICAgICAgc2hvd1Jlc3VsdCgn4pqg77iPIEdpdEh1YiB0b2tlbiBub3QgY29uZmlndXJlZC4gUGxlYXNlIHNldCB5b3VyIHRva2VuIGluIHRoZSBjb2RlLicsICdlcnJvcicpOwogICAgICAgICAgICAgICAgZWxlbWVudHMuZGVwbG95QnRuLmRpc2FibGVkID0gdHJ1ZTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAoIVJFUE9TSVRPUllfTkFNRSB8fCBSRVBPU0lUT1JZX05BTUUgPT09ICdteS13ZWJzaXRlcycpIHsKICAgICAgICAgICAgICAgIHNob3dSZXN1bHQoJ+KaoO+4jyBSZXBvc2l0b3J5IG5hbWUgbm90IGNvbmZpZ3VyZWQuIFBsZWFzZSBzZXQgeW91ciByZXBvc2l0b3J5IG5hbWUuJywgJ2Vycm9yJyk7CiAgICAgICAgICAgICAgICBlbGVtZW50cy5kZXBsb3lCdG4uZGlzYWJsZWQgPSB0cnVlOwogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsZW1lbnRzLnJlcG9QcmV2aWV3LnRleHRDb250ZW50ID0gUkVQT1NJVE9SWV9OQU1FOwogICAgICAgICAgICByZW5kZXJRdWlja0xpbmtzKCk7CiAgICAgICAgICAgIHNldHVwRXZlbnRMaXN0ZW5lcnMoKTsKICAgICAgICAgICAgZ3NhcC5mcm9tKCduYXYnLCB7IGR1cmF0aW9uOiAwLjgsIHk6IC01MCwgb3BhY2l0eTogMCB9KTsKICAgICAgICAgICAgZ3NhcC5mcm9tKCcuZ2xhc3MtY2FyZCcsIHsgZHVyYXRpb246IDAuOCwgeTogMzAsIG9wYWNpdHk6IDAsIHN0YWdnZXI6IDAuMSwgZGVsYXk6IDAuMiB9KTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLy8gUmVuZGVyIFF1aWNrIExpbmtzCiAgICAgICAgZnVuY3Rpb24gcmVuZGVyUXVpY2tMaW5rcygpIHsKICAgICAgICAgICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3F1aWNrTGlua3NDb250YWluZXInKTsKICAgICAgICAgICAgY29udGFpbmVyLmlubmVySFRNTCA9ICcnOwogICAgICAgICAgICAKICAgICAgICAgICAgUVVJQ0tfTElOS1MuZm9yRWFjaChsaW5rID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IGxpbmtFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpOwogICAgICAgICAgICAgICAgbGlua0VsZW1lbnQuaHJlZiA9IGxpbmsudXJsOwogICAgICAgICAgICAgICAgbGlua0VsZW1lbnQudGFyZ2V0ID0gJ19ibGFuayc7CiAgICAgICAgICAgICAgICBsaW5rRWxlbWVudC5jbGFzc05hbWUgPSAnZmxleCBpdGVtcy1jZW50ZXIgcC0yIHJvdW5kZWQtbGcgaG92ZXI6Ymctd2hpdGUvNSB0cmFuc2l0aW9uLWNvbG9ycyBncm91cCc7CiAgICAgICAgICAgICAgICBsaW5rRWxlbWVudC5pbm5lckhUTUwgPSBgCiAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9IiR7bGluay5pY29ufSAke2xpbmsuY29sb3J9IG1yLTMgdGV4dC1sZyI+PC9pPgogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZsZXgtMSI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InRleHQtc20gdGV4dC1ncmF5LTMwMCBncm91cC1ob3Zlcjp0ZXh0LXdoaXRlIHRyYW5zaXRpb24iPiR7bGluay50aXRsZX08L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLWV4dGVybmFsLWxpbmstYWx0IHRleHQtZ3JheS02MDAgdGV4dC14cyBncm91cC1ob3Zlcjp0ZXh0LWdyYXktNDAwIj48L2k+CiAgICAgICAgICAgICAgICBgOwogICAgICAgICAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKGxpbmtFbGVtZW50KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8vIFNldHVwIEV2ZW50IExpc3RlbmVycwogICAgICAgIGZ1bmN0aW9uIHNldHVwRXZlbnRMaXN0ZW5lcnMoKSB7CiAgICAgICAgICAgIC8vIFNpZGViYXIKICAgICAgICAgICAgZWxlbWVudHMuc2lkZWJhclRvZ2dsZS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgICAgICAgICAgIGVsZW1lbnRzLnNpZGViYXIuY2xhc3NMaXN0LmFkZCgnb3BlbicpOwogICAgICAgICAgICAgICAgZWxlbWVudHMuc2lkZWJhck92ZXJsYXkuY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAKICAgICAgICAgICAgZWxlbWVudHMuY2xvc2VTaWRlYmFyLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgY2xvc2VTaWRlYmFyKTsKICAgICAgICAgICAgZWxlbWVudHMuc2lkZWJhck92ZXJsYXkuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBjbG9zZVNpZGViYXIpOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gU2l0ZSBuYW1lCiAgICAgICAgICAgIGVsZW1lbnRzLnNpdGVOYW1lSW5wdXQuYWRkRXZlbnRMaXN0ZW5lcignaW5wdXQnLCAoZSkgPT4gewogICAgICAgICAgICAgICAgY29uc3QgbmFtZSA9IGUudGFyZ2V0LnZhbHVlIHx8ICd3ZWJzaXRlLW5hbWUnOwogICAgICAgICAgICAgICAgZWxlbWVudHMuc2l0ZU5hbWVQcmV2aWV3LnRleHRDb250ZW50ID0gbmFtZTsKICAgICAgICAgICAgICAgIGVsZW1lbnRzLnNpdGVGb2xkZXJQcmV2aWV3LnRleHRDb250ZW50ID0gbmFtZTsKICAgICAgICAgICAgICAgIHVwZGF0ZVN0cnVjdHVyZVByZXZpZXcoKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBIVE1MIGZpbGUKICAgICAgICAgICAgZWxlbWVudHMuaHRtbERyb3Bab25lLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gZWxlbWVudHMuaHRtbEZpbGVJbnB1dC5jbGljaygpKTsKICAgICAgICAgICAgZWxlbWVudHMuaHRtbERyb3Bab25lLmFkZEV2ZW50TGlzdGVuZXIoJ2RyYWdvdmVyJywgaGFuZGxlRHJhZ092ZXIpOwogICAgICAgICAgICBlbGVtZW50cy5odG1sRHJvcFpvbmUuYWRkRXZlbnRMaXN0ZW5lcignZHJhZ2xlYXZlJywgaGFuZGxlRHJhZ0xlYXZlKTsKICAgICAgICAgICAgZWxlbWVudHMuaHRtbERyb3Bab25lLmFkZEV2ZW50TGlzdGVuZXIoJ2Ryb3AnLCAoZSkgPT4gaGFuZGxlRHJvcChlLCAnaHRtbCcpKTsKICAgICAgICAgICAgZWxlbWVudHMuaHRtbEZpbGVJbnB1dC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCAoZSkgPT4gewogICAgICAgICAgICAgICAgaWYgKGUudGFyZ2V0LmZpbGVzLmxlbmd0aCA+IDApIGhhbmRsZUh0bWxGaWxlKGUudGFyZ2V0LmZpbGVzWzBdKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBBc3NldHMgLSBGaXhlZCBidXR0b24gaGFuZGxlcnMKICAgICAgICAgICAgZWxlbWVudHMuc2VsZWN0RmlsZXNCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4gewogICAgICAgICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICAgICAgICAgIGVsZW1lbnRzLmFzc2V0c0ZpbGVJbnB1dC5jbGljaygpOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGVsZW1lbnRzLnNlbGVjdEZvbGRlckJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChlKSA9PiB7CiAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpOwogICAgICAgICAgICAgICAgZWxlbWVudHMuZm9sZGVySW5wdXQuY2xpY2soKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBlbGVtZW50cy5hc3NldHNEcm9wWm9uZS5hZGRFdmVudExpc3RlbmVyKCdkcmFnb3ZlcicsIGhhbmRsZURyYWdPdmVyKTsKICAgICAgICAgICAgZWxlbWVudHMuYXNzZXRzRHJvcFpvbmUuYWRkRXZlbnRMaXN0ZW5lcignZHJhZ2xlYXZlJywgaGFuZGxlRHJhZ0xlYXZlKTsKICAgICAgICAgICAgZWxlbWVudHMuYXNzZXRzRHJvcFpvbmUuYWRkRXZlbnRMaXN0ZW5lcignZHJvcCcsIChlKSA9PiBoYW5kbGVEcm9wKGUsICdhc3NldHMnKSk7CiAgICAgICAgICAgIGVsZW1lbnRzLmFzc2V0c0ZpbGVJbnB1dC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCAoZSkgPT4gewogICAgICAgICAgICAgICAgaGFuZGxlQXNzZXRGaWxlcyhBcnJheS5mcm9tKGUudGFyZ2V0LmZpbGVzKSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICBlbGVtZW50cy5mb2xkZXJJbnB1dC5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCAoZSkgPT4gewogICAgICAgICAgICAgICAgaGFuZGxlQXNzZXRGaWxlcyhBcnJheS5mcm9tKGUudGFyZ2V0LmZpbGVzKSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gQnV0dG9ucwogICAgICAgICAgICBlbGVtZW50cy5kZXBsb3lCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBkZXBsb3kpOwogICAgICAgICAgICBlbGVtZW50cy5jbGVhckJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGNsZWFyQWxsKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIEZvbGRlciBtYW5hZ2VtZW50CiAgICAgICAgICAgIGVsZW1lbnRzLmNyZWF0ZUZvbGRlckJ0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGNyZWF0ZUZvbGRlcik7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGZ1bmN0aW9uIGNsb3NlU2lkZWJhcigpIHsKICAgICAgICAgICAgZWxlbWVudHMuc2lkZWJhci5jbGFzc0xpc3QucmVtb3ZlKCdvcGVuJyk7CiAgICAgICAgICAgIGVsZW1lbnRzLnNpZGViYXJPdmVybGF5LmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAvLyBEcmFnICYgRHJvcCBIYW5kbGVycwogICAgICAgIGZ1bmN0aW9uIGhhbmRsZURyYWdPdmVyKGUpIHsKICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpOwogICAgICAgICAgICBlLmN1cnJlbnRUYXJnZXQuY2xhc3NMaXN0LmFkZCgnYWN0aXZlJyk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGZ1bmN0aW9uIGhhbmRsZURyYWdMZWF2ZShlKSB7CiAgICAgICAgICAgIGUuY3VycmVudFRhcmdldC5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgZnVuY3Rpb24gaGFuZGxlRHJvcChlLCB0eXBlKSB7CiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgICAgZS5jdXJyZW50VGFyZ2V0LmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpOwogICAgICAgICAgICAKICAgICAgICAgICAgY29uc3QgaXRlbXMgPSBlLmRhdGFUcmFuc2Zlci5pdGVtczsKICAgICAgICAgICAgY29uc3QgZmlsZXMgPSBbXTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIChpdGVtcykgewogICAgICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBpdGVtcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICAgICAgICAgIGNvbnN0IGl0ZW0gPSBpdGVtc1tpXS53ZWJraXRHZXRBc0VudHJ5KCk7CiAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0pIHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGl0ZW0uaXNGaWxlKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpdGVtc1tpXS5nZXRBc0ZpbGUoKSAmJiBmaWxlcy5wdXNoKGl0ZW1zW2ldLmdldEFzRmlsZSgpKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChpdGVtLmlzRGlyZWN0b3J5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWFkRGlyZWN0b3J5KGl0ZW0sIGZpbGVzKTsKICAgICAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgICAgICAgICAgIGlmICh0eXBlID09PSAnaHRtbCcgJiYgZmlsZXMubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGVIdG1sRmlsZShmaWxlc1swXSk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmICh0eXBlID09PSAnYXNzZXRzJykgewogICAgICAgICAgICAgICAgICAgICAgICBoYW5kbGVBc3NldEZpbGVzKGZpbGVzKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9LCAxMDApOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgY29uc3QgZHJvcHBlZEZpbGVzID0gQXJyYXkuZnJvbShlLmRhdGFUcmFuc2Zlci5maWxlcyk7CiAgICAgICAgICAgICAgICBpZiAodHlwZSA9PT0gJ2h0bWwnICYmIGRyb3BwZWRGaWxlcy5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgICAgICAgICAgaGFuZGxlSHRtbEZpbGUoZHJvcHBlZEZpbGVzWzBdKTsKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAodHlwZSA9PT0gJ2Fzc2V0cycpIHsKICAgICAgICAgICAgICAgICAgICBoYW5kbGVBc3NldEZpbGVzKGRyb3BwZWRGaWxlcyk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgZnVuY3Rpb24gcmVhZERpcmVjdG9yeShkaXJlY3RvcnksIGZpbGVzKSB7CiAgICAgICAgICAgIGNvbnN0IHJlYWRlciA9IGRpcmVjdG9yeS5jcmVhdGVSZWFkZXIoKTsKICAgICAgICAgICAgcmVhZGVyLnJlYWRFbnRyaWVzKChlbnRyaWVzKSA9PiB7CiAgICAgICAgICAgICAgICBlbnRyaWVzLmZvckVhY2goKGVudHJ5KSA9PiB7CiAgICAgICAgICAgICAgICAgICAgaWYgKGVudHJ5LmlzRmlsZSkgewogICAgICAgICAgICAgICAgICAgICAgICBlbnRyeS5maWxlKChmaWxlKSA9PiBmaWxlcy5wdXNoKGZpbGUpKTsKICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKGVudHJ5LmlzRGlyZWN0b3J5KSB7CiAgICAgICAgICAgICAgICAgICAgICAgIHJlYWREaXJlY3RvcnkoZW50cnksIGZpbGVzKTsKICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8vIEZpbGUgSGFuZGxlcnMKICAgICAgICBmdW5jdGlvbiBoYW5kbGVIdG1sRmlsZShmaWxlKSB7CiAgICAgICAgICAgIGlmICghZmlsZS5uYW1lLmVuZHNXaXRoKCcuaHRtbCcpKSB7CiAgICAgICAgICAgICAgICBhbGVydCgnUGxlYXNlIHNlbGVjdCBhbiBIVE1MIGZpbGUgZm9yIHRoZSBtYWluIGZpbGUgc2VjdGlvbi4nKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICBodG1sRmlsZSA9IGZpbGU7CiAgICAgICAgICAgIGVsZW1lbnRzLmh0bWxGaWxlTGlzdC5pbm5lckhUTUwgPSBgCiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmaWxlLWl0ZW0gZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1iZXR3ZWVuIGdsYXNzLWNhcmQgcC00IHJvdW5kZWQtbGcgYm9yZGVyIGJvcmRlci1ibHVlLTUwMC8zMCI+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxleCBpdGVtcy1jZW50ZXIgZmxleC0xIj4KICAgICAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9ImZhYiBmYS1odG1sNSB0ZXh0LW9yYW5nZS00MDAgdGV4dC0yeGwgbXItMyI+PC9pPgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmbGV4LTEiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZm9udC1tZWRpdW0gdGV4dC13aGl0ZSI+JHtmaWxlLm5hbWV9PC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ0ZXh0LXhzIHRleHQtYmx1ZS0zMDAgbXQtMSI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS1hcnJvdy1yaWdodCBtci0xIj48L2k+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgV2lsbCBiZSByZW5hbWVkIHRvIDxzdHJvbmc+aW5kZXguaHRtbDwvc3Ryb25nPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJ0ZXh0LXhzIHRleHQtZ3JheS01MDAgbXQtMSI+JHtmb3JtYXRGaWxlU2l6ZShmaWxlLnNpemUpfTwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIG9uY2xpY2s9InJlbW92ZUh0bWxGaWxlKCkiIGNsYXNzPSJ0ZXh0LXJlZC00MDAgaG92ZXI6dGV4dC1yZWQtMzAwIHAtMiByb3VuZGVkIGhvdmVyOmJnLXJlZC01MDAvMTAgdHJhbnNpdGlvbiI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtdGltZXMiPjwvaT4KICAgICAgICAgICAgICAgICAgICA8L2J1dHRvbj4KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICBgOwogICAgICAgICAgICB1cGRhdGVTdHJ1Y3R1cmVQcmV2aWV3KCk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGZ1bmN0aW9uIGhhbmRsZUFzc2V0RmlsZXMoZmlsZXMpIHsKICAgICAgICAgICAgZmlsZXMuZm9yRWFjaChmaWxlID0+IHsKICAgICAgICAgICAgICAgIGlmIChmaWxlLm5hbWUuZW5kc1dpdGgoJy5odG1sJykpIHsKICAgICAgICAgICAgICAgICAgICBhbGVydChgIiR7ZmlsZS5uYW1lfSIgaXMgYW4gSFRNTCBmaWxlLiBQbGVhc2UgYWRkIGl0IHRvIHRoZSBNYWluIEhUTUwgRmlsZSBzZWN0aW9uLmApOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIGlmIChhc3NldEZpbGVzLnNvbWUoZiA9PiBmLm5hbWUgPT09IGZpbGUubmFtZSAmJiBmLnNpemUgPT09IGZpbGUuc2l6ZSkpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBhc3NldEZpbGVzLnB1c2goZmlsZSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICByZW5kZXJBc3NldEZpbGVzKCk7CiAgICAgICAgICAgIHVwZGF0ZVN0cnVjdHVyZVByZXZpZXcoKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgZnVuY3Rpb24gcmVuZGVyQXNzZXRGaWxlcygpIHsKICAgICAgICAgICAgZWxlbWVudHMuYXNzZXRzRmlsZUxpc3QuaW5uZXJIVE1MID0gJyc7CiAgICAgICAgICAgIGFzc2V0RmlsZXMuZm9yRWFjaCgoZmlsZSwgaW5kZXgpID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IGZpbGVFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgICAgICAgICBmaWxlRWxlbWVudC5jbGFzc05hbWUgPSAnZmlsZS1pdGVtIGZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktYmV0d2VlbiBnbGFzcy1jYXJkIHAtMyByb3VuZGVkLWxnIGJvcmRlciBib3JkZXItZ3JlZW4tNTAwLzMwJzsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY29uc3QgYXNzaWduZWRGb2xkZXIgPSBmaWxlVG9Gb2xkZXJNYXBwaW5nW2ZpbGUubmFtZV0gfHwgJ3Jvb3QnOwogICAgICAgICAgICAgICAgY29uc3QgZm9sZGVyT3B0aW9ucyA9IGN1c3RvbUZvbGRlcnMubGVuZ3RoID4gMCA/CiAgICAgICAgICAgICAgICAgICAgYDxzZWxlY3Qgb25jaGFuZ2U9ImFzc2lnbkZpbGVUb0ZvbGRlcignJHtmaWxlLm5hbWV9JywgdGhpcy52YWx1ZSkiIGNsYXNzPSJiZy1ncmF5LTgwMCB0ZXh0LXdoaXRlIHRleHQteHMgcHgtMiBweS0xIHJvdW5kZWQgbWwtMiBib3JkZXIgYm9yZGVyLWdyYXktNjAwIj4KICAgICAgICAgICAgICAgICAgICAgICAgPG9wdGlvbiB2YWx1ZT0icm9vdCIgJHthc3NpZ25lZEZvbGRlciA9PT0gJ3Jvb3QnID8gJ3NlbGVjdGVkJyA6ICcnfT7wn5OBIFJvb3Q8L29wdGlvbj4KICAgICAgICAgICAgICAgICAgICAgICAgJHtjdXN0b21Gb2xkZXJzLm1hcChmb2xkZXIgPT4gCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBgPG9wdGlvbiB2YWx1ZT0iJHtmb2xkZXJ9IiAke2Fzc2lnbmVkRm9sZGVyID09PSBmb2xkZXIgPyAnc2VsZWN0ZWQnIDogJyd9PvCfk4EgJHtmb2xkZXJ9PC9vcHRpb24+YAogICAgICAgICAgICAgICAgICAgICAgICApLmpvaW4oJycpfQogICAgICAgICAgICAgICAgICAgIDwvc2VsZWN0PmAgOgogICAgICAgICAgICAgICAgICAgICc8c3BhbiBjbGFzcz0idGV4dC14cyB0ZXh0LWdyYXktNTAwIG1sLTIiPvCfk4EgUm9vdDwvc3Bhbj4nOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBmaWxlRWxlbWVudC5pbm5lckhUTUwgPSBgCiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxleCBpdGVtcy1jZW50ZXIgZmxleC0xIj4KICAgICAgICAgICAgICAgICAgICAgICAgJHtnZXRGaWxlSWNvbihmaWxlLm5hbWUpfQogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmbGV4LTEiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZm9udC1tZWRpdW0gdGV4dC13aGl0ZSB0ZXh0LXNtIj4ke2ZpbGUubmFtZX08L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InRleHQteHMgdGV4dC1ncmF5LTUwMCI+JHtmb3JtYXRGaWxlU2l6ZShmaWxlLnNpemUpfTwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgJHtmb2xkZXJPcHRpb25zfQogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgIDxidXR0b24gb25jbGljaz0icmVtb3ZlQXNzZXRGaWxlKCR7aW5kZXh9KSIgY2xhc3M9InRleHQtcmVkLTQwMCBob3Zlcjp0ZXh0LXJlZC0zMDAgcC0yIHJvdW5kZWQgaG92ZXI6YmctcmVkLTUwMC8xMCB0cmFuc2l0aW9uIG1sLTIiPgogICAgICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLXRpbWVzIj48L2k+CiAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgICAgICAgICBgOwogICAgICAgICAgICAgICAgZWxlbWVudHMuYXNzZXRzRmlsZUxpc3QuYXBwZW5kQ2hpbGQoZmlsZUVsZW1lbnQpOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgZWxlbWVudHMuZmlsZUNvdW50LnRleHRDb250ZW50ID0gYCR7YXNzZXRGaWxlcy5sZW5ndGh9IGZpbGUocykgYWRkZWRgOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAvLyBGb2xkZXIgTWFuYWdlbWVudCBGdW5jdGlvbnMKICAgICAgICBmdW5jdGlvbiBjcmVhdGVGb2xkZXIoKSB7CiAgICAgICAgICAgIGlmIChjdXN0b21Gb2xkZXJzLmxlbmd0aCA+PSA1MCkgewogICAgICAgICAgICAgICAgYWxlcnQoJ+KaoO+4jyBNYXhpbXVtIGZvbGRlciBsaW1pdCByZWFjaGVkICg1MCBmb2xkZXJzKScpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBjb25zdCBmb2xkZXJOYW1lID0gcHJvbXB0KCdFbnRlciBmb2xkZXIgbmFtZSAoZS5nLiwgImltZyIsICJjc3MiLCBvciAiaW1nL2ljb25zIiBmb3IgbmVzdGVkKTonKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmICghZm9sZGVyTmFtZSkgcmV0dXJuOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gVmFsaWRhdGUgZm9sZGVyIG5hbWUKICAgICAgICAgICAgY29uc3QgdHJpbW1lZE5hbWUgPSBmb2xkZXJOYW1lLnRyaW0oKTsKICAgICAgICAgICAgaWYgKCF0cmltbWVkTmFtZSkgewogICAgICAgICAgICAgICAgYWxlcnQoJ+KaoO+4jyBGb2xkZXIgbmFtZSBjYW5ub3QgYmUgZW1wdHknKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQogICAgICAgICAgICAKICAgICAgICAgICAgLy8gQ2hlY2sgZm9yIGludmFsaWQgY2hhcmFjdGVycwogICAgICAgICAgICBpZiAoL1s8PjoifD8qXHgwMC1ceDFGXS8udGVzdCh0cmltbWVkTmFtZSkpIHsKICAgICAgICAgICAgICAgIGFsZXJ0KCfimqDvuI8gRm9sZGVyIG5hbWUgY29udGFpbnMgaW52YWxpZCBjaGFyYWN0ZXJzJyk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIENoZWNrIGlmIGZvbGRlciBhbHJlYWR5IGV4aXN0cwogICAgICAgICAgICBpZiAoY3VzdG9tRm9sZGVycy5pbmNsdWRlcyh0cmltbWVkTmFtZSkpIHsKICAgICAgICAgICAgICAgIGFsZXJ0KCfimqDvuI8gRm9sZGVyIGFscmVhZHkgZXhpc3RzJyk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIGN1c3RvbUZvbGRlcnMucHVzaCh0cmltbWVkTmFtZSk7CiAgICAgICAgICAgIHJlbmRlckZvbGRlcnMoKTsKICAgICAgICAgICAgcmVuZGVyQXNzZXRGaWxlcygpOyAvLyBSZS1yZW5kZXIgZmlsZXMgdG8gc2hvdyBuZXcgZm9sZGVyIG9wdGlvbgogICAgICAgICAgICB1cGRhdGVTdHJ1Y3R1cmVQcmV2aWV3KCk7CiAgICAgICAgICAgIAogICAgICAgICAgICBnc2FwLmZyb20oYCNmb2xkZXItJHtjdXN0b21Gb2xkZXJzLmxlbmd0aCAtIDF9YCwgeyBkdXJhdGlvbjogMC4zLCBzY2FsZTogMC44LCBvcGFjaXR5OiAwIH0pOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBmdW5jdGlvbiBjcmVhdGVTdWJmb2xkZXIocGFyZW50Rm9sZGVyKSB7CiAgICAgICAgICAgIGlmIChjdXN0b21Gb2xkZXJzLmxlbmd0aCA+PSA1MCkgewogICAgICAgICAgICAgICAgYWxlcnQoJ+KaoO+4jyBNYXhpbXVtIGZvbGRlciBsaW1pdCByZWFjaGVkICg1MCBmb2xkZXJzKScpOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBjb25zdCBzdWJmb2xkZXJOYW1lID0gcHJvbXB0KGBDcmVhdGUgc3ViZm9sZGVyIGluc2lkZSAiJHtwYXJlbnRGb2xkZXJ9IjpcblxuRW50ZXIgc3ViZm9sZGVyIG5hbWUgKGUuZy4sICJpY29ucyIsICJ0aHVtYm5haWxzIik6YCk7CiAgICAgICAgICAgIAogICAgICAgICAgICBpZiAoIXN1YmZvbGRlck5hbWUpIHJldHVybjsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIFZhbGlkYXRlIHN1YmZvbGRlciBuYW1lCiAgICAgICAgICAgIGNvbnN0IHRyaW1tZWROYW1lID0gc3ViZm9sZGVyTmFtZS50cmltKCk7CiAgICAgICAgICAgIGlmICghdHJpbW1lZE5hbWUpIHsKICAgICAgICAgICAgICAgIGFsZXJ0KCfimqDvuI8gRm9sZGVyIG5hbWUgY2Fubm90IGJlIGVtcHR5Jyk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIENoZWNrIGZvciBpbnZhbGlkIGNoYXJhY3RlcnMKICAgICAgICAgICAgaWYgKC9bPD46Inw/Klx4MDAtXHgxRlwvXFxdLy50ZXN0KHRyaW1tZWROYW1lKSkgewogICAgICAgICAgICAgICAgYWxlcnQoJ+KaoO+4jyBGb2xkZXIgbmFtZSBjb250YWlucyBpbnZhbGlkIGNoYXJhY3RlcnMgKG5vIHNsYXNoZXMgYWxsb3dlZCBpbiBzdWJmb2xkZXIgbmFtZXMpJyk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIENyZWF0ZSBmdWxsIHBhdGgKICAgICAgICAgICAgY29uc3QgZnVsbFBhdGggPSBgJHtwYXJlbnRGb2xkZXJ9LyR7dHJpbW1lZE5hbWV9YDsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIENoZWNrIGlmIGZvbGRlciBhbHJlYWR5IGV4aXN0cwogICAgICAgICAgICBpZiAoY3VzdG9tRm9sZGVycy5pbmNsdWRlcyhmdWxsUGF0aCkpIHsKICAgICAgICAgICAgICAgIGFsZXJ0KCfimqDvuI8gU3ViZm9sZGVyIGFscmVhZHkgZXhpc3RzJyk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIGN1c3RvbUZvbGRlcnMucHVzaChmdWxsUGF0aCk7CiAgICAgICAgICAgIHJlbmRlckZvbGRlcnMoKTsKICAgICAgICAgICAgcmVuZGVyQXNzZXRGaWxlcygpOwogICAgICAgICAgICB1cGRhdGVTdHJ1Y3R1cmVQcmV2aWV3KCk7CiAgICAgICAgICAgIAogICAgICAgICAgICBnc2FwLmZyb20oYCNmb2xkZXItJHtjdXN0b21Gb2xkZXJzLmxlbmd0aCAtIDF9YCwgeyBkdXJhdGlvbjogMC4zLCBzY2FsZTogMC44LCBvcGFjaXR5OiAwIH0pOwogICAgICAgIH0KICAgICAgICAKICAgICAgICB3aW5kb3cuY3JlYXRlU3ViZm9sZGVyID0gY3JlYXRlU3ViZm9sZGVyOwogICAgICAgIAogICAgICAgIGZ1bmN0aW9uIHJlbmRlckZvbGRlcnMoKSB7CiAgICAgICAgICAgIGVsZW1lbnRzLmZvbGRlckNvdW50LnRleHRDb250ZW50ID0gY3VzdG9tRm9sZGVycy5sZW5ndGg7CiAgICAgICAgICAgIAogICAgICAgICAgICBpZiAoY3VzdG9tRm9sZGVycy5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgICAgIGVsZW1lbnRzLmZvbGRlckxpc3QuaW5uZXJIVE1MID0gJzxwIGNsYXNzPSJ0ZXh0LWdyYXktNTAwIHRleHQtc20iPk5vIGZvbGRlcnMgY3JlYXRlZCB5ZXQuIENsaWNrICJDcmVhdGUgRm9sZGVyIiB0byBhZGQgb25lLjwvcD4nOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBTb3J0IGZvbGRlcnMgdG8gc2hvdyBwYXJlbnQgZm9sZGVycyBiZWZvcmUgdGhlaXIgc3ViZm9sZGVycwogICAgICAgICAgICBjb25zdCBzb3J0ZWRGb2xkZXJzID0gWy4uLmN1c3RvbUZvbGRlcnNdLnNvcnQoKGEsIGIpID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IGFEZXB0aCA9IChhLm1hdGNoKC9cLy9nKSB8fCBbXSkubGVuZ3RoOwogICAgICAgICAgICAgICAgY29uc3QgYkRlcHRoID0gKGIubWF0Y2goL1wvL2cpIHx8IFtdKS5sZW5ndGg7CiAgICAgICAgICAgICAgICBpZiAoYURlcHRoICE9PSBiRGVwdGgpIHJldHVybiBhRGVwdGggLSBiRGVwdGg7CiAgICAgICAgICAgICAgICByZXR1cm4gYS5sb2NhbGVDb21wYXJlKGIpOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGVsZW1lbnRzLmZvbGRlckxpc3QuaW5uZXJIVE1MID0gJyc7CiAgICAgICAgICAgIHNvcnRlZEZvbGRlcnMuZm9yRWFjaCgoZm9sZGVyLCBkaXNwbGF5SW5kZXgpID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IGFjdHVhbEluZGV4ID0gY3VzdG9tRm9sZGVycy5pbmRleE9mKGZvbGRlcik7CiAgICAgICAgICAgICAgICBjb25zdCBkZXB0aCA9IChmb2xkZXIubWF0Y2goL1wvL2cpIHx8IFtdKS5sZW5ndGg7CiAgICAgICAgICAgICAgICBjb25zdCBmb2xkZXJOYW1lID0gZm9sZGVyLnNwbGl0KCcvJykucG9wKCk7CiAgICAgICAgICAgICAgICBjb25zdCBpbmRlbnQgPSBkZXB0aCAqIDIwOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBjb25zdCBmb2xkZXJFbGVtZW50ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7CiAgICAgICAgICAgICAgICBmb2xkZXJFbGVtZW50LmlkID0gYGZvbGRlci0ke2FjdHVhbEluZGV4fWA7CiAgICAgICAgICAgICAgICBmb2xkZXJFbGVtZW50LmNsYXNzTmFtZSA9ICdnbGFzcy1jYXJkIHAtNCByb3VuZGVkLWxnIGJvcmRlciBib3JkZXIteWVsbG93LTUwMC8zMCBzcGFjZS15LTMnOwogICAgICAgICAgICAgICAgZm9sZGVyRWxlbWVudC5zdHlsZS5tYXJnaW5MZWZ0ID0gYCR7aW5kZW50fXB4YDsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgZm9sZGVyRWxlbWVudC5pbm5lckhUTUwgPSBgCiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1iZXR3ZWVuIj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxleCBpdGVtcy1jZW50ZXIgZmxleC0xIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtZm9sZGVyJHtkZXB0aCA+IDAgPyAnJyA6ICctb3Blbid9IHRleHQteWVsbG93LTQwMCB0ZXh0LWxnIG1yLTMiPjwvaT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZsZXgtMSI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTIiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0idGV4dC13aGl0ZSBmb250LW1lZGl1bSI+JHtmb2xkZXJOYW1lfTwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHtkZXB0aCA+IDAgPyBgPHNwYW4gY2xhc3M9InRleHQteHMgdGV4dC1ncmF5LTUwMCI+aW4gJHtmb2xkZXIuc3Vic3RyaW5nKDAsIGZvbGRlci5sYXN0SW5kZXhPZignLycpKX08L3NwYW4+YCA6ICcnfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJ0ZXh0LXhzIHRleHQtZ3JheS01MDAiPigke2NvdW50RmlsZXNJbkZvbGRlcihmb2xkZXIpfSBmaWxlcyk8L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZsZXggaXRlbXMtY2VudGVyIGdhcC0yIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxidXR0b24gb25jbGljaz0iY3JlYXRlU3ViZm9sZGVyKCcke2ZvbGRlcn0nKSIgY2xhc3M9ImJnLWJsdWUtNTAwLzIwIGhvdmVyOmJnLWJsdWUtNTAwLzMwIHRleHQtYmx1ZS0zMDAgcHgtMyBweS0xLjUgcm91bmRlZCB0ZXh0LXhzIHRyYW5zaXRpb24gYm9yZGVyIGJvcmRlci1ibHVlLTUwMC8zMCIgdGl0bGU9IkNyZWF0ZSBzdWJmb2xkZXIiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtZm9sZGVyLXBsdXMgbXItMSI+PC9pPlN1YmZvbGRlcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIG9uY2xpY2s9InJlbW92ZUZvbGRlcigke2FjdHVhbEluZGV4fSkiIGNsYXNzPSJ0ZXh0LXJlZC00MDAgaG92ZXI6dGV4dC1yZWQtMzAwIHAtMiByb3VuZGVkIGhvdmVyOmJnLXJlZC01MDAvMTAgdHJhbnNpdGlvbiI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS10cmFzaCB0ZXh0LXNtIj48L2k+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2J1dHRvbj4KICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgPCEtLSBVcGxvYWQgdG8gRm9sZGVyIFNlY3Rpb24gLS0+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iYm9yZGVyLXQgYm9yZGVyLWdyYXktNzAwIHB0LTMiPgogICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMiI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8YnV0dG9uIG9uY2xpY2s9InNlbGVjdEZpbGVzRm9yRm9sZGVyKCcke2ZvbGRlcn0nKSIgY2xhc3M9ImZsZXgtMSBiZy1ncmVlbi01MDAvMjAgaG92ZXI6YmctZ3JlZW4tNTAwLzMwIHRleHQtZ3JlZW4tMzAwIHB4LTMgcHktMiByb3VuZGVkIHRleHQtc20gdHJhbnNpdGlvbiBib3JkZXIgYm9yZGVyLWdyZWVuLTUwMC8zMCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS1maWxlLXVwbG9hZCBtci0yIj48L2k+VXBsb2FkIEZpbGVzIEhlcmUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBvbmNsaWNrPSJzZWxlY3RGb2xkZXJGb3JGb2xkZXIoJyR7Zm9sZGVyfScpIiBjbGFzcz0iZmxleC0xIGJnLXB1cnBsZS01MDAvMjAgaG92ZXI6YmctcHVycGxlLTUwMC8zMCB0ZXh0LXB1cnBsZS0zMDAgcHgtMyBweS0yIHJvdW5kZWQgdGV4dC1zbSB0cmFuc2l0aW9uIGJvcmRlciBib3JkZXItcHVycGxlLTUwMC8zMCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS1mb2xkZXItb3BlbiBtci0yIj48L2k+VXBsb2FkIEZvbGRlcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9idXR0b24+CiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8aW5wdXQgdHlwZT0iZmlsZSIgaWQ9ImZvbGRlclVwbG9hZC0ke2FjdHVhbEluZGV4fSIgY2xhc3M9ImhpZGRlbiIgbXVsdGlwbGUgZGF0YS1mb2xkZXI9IiR7Zm9sZGVyfSI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxpbnB1dCB0eXBlPSJmaWxlIiBpZD0iZm9sZGVyRGlyVXBsb2FkLSR7YWN0dWFsSW5kZXh9IiBjbGFzcz0iaGlkZGVuIiB3ZWJraXRkaXJlY3RvcnkgZGlyZWN0b3J5IG11bHRpcGxlIGRhdGEtZm9sZGVyPSIke2ZvbGRlcn0iPgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIDwhLS0gRmlsZXMgaW4gdGhpcyBmb2xkZXIgLS0+CiAgICAgICAgICAgICAgICAgICAgPGRpdiBpZD0iZm9sZGVyRmlsZXMtJHthY3R1YWxJbmRleH0iIGNsYXNzPSJzcGFjZS15LTEiPjwvZGl2PgogICAgICAgICAgICAgICAgYDsKICAgICAgICAgICAgICAgIGVsZW1lbnRzLmZvbGRlckxpc3QuYXBwZW5kQ2hpbGQoZm9sZGVyRWxlbWVudCk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIFJlbmRlciBmaWxlcyBpbiB0aGlzIGZvbGRlcgogICAgICAgICAgICAgICAgcmVuZGVyRmlsZXNJbkZvbGRlcihmb2xkZXIsIGFjdHVhbEluZGV4KTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gQWRkIGV2ZW50IGxpc3RlbmVycyBmb3IgdGhlIGZpbGUgaW5wdXRzCiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgZm9sZGVyVXBsb2FkLSR7YWN0dWFsSW5kZXh9YCkuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgKGUpID0+IHsKICAgICAgICAgICAgICAgICAgICBoYW5kbGVGb2xkZXJTcGVjaWZpY1VwbG9hZChlLCBmb2xkZXIpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgZm9sZGVyRGlyVXBsb2FkLSR7YWN0dWFsSW5kZXh9YCkuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgKGUpID0+IHsKICAgICAgICAgICAgICAgICAgICBoYW5kbGVGb2xkZXJTcGVjaWZpY1VwbG9hZChlLCBmb2xkZXIpOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gVXBkYXRlIGJ1dHRvbiBzdGF0ZQogICAgICAgICAgICBpZiAoY3VzdG9tRm9sZGVycy5sZW5ndGggPj0gNTApIHsKICAgICAgICAgICAgICAgIGVsZW1lbnRzLmNyZWF0ZUZvbGRlckJ0bi5kaXNhYmxlZCA9IHRydWU7CiAgICAgICAgICAgICAgICBlbGVtZW50cy5jcmVhdGVGb2xkZXJCdG4uY2xhc3NMaXN0LmFkZCgnb3BhY2l0eS01MCcsICdjdXJzb3Itbm90LWFsbG93ZWQnKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGVsZW1lbnRzLmNyZWF0ZUZvbGRlckJ0bi5kaXNhYmxlZCA9IGZhbHNlOwogICAgICAgICAgICAgICAgZWxlbWVudHMuY3JlYXRlRm9sZGVyQnRuLmNsYXNzTGlzdC5yZW1vdmUoJ29wYWNpdHktNTAnLCAnY3Vyc29yLW5vdC1hbGxvd2VkJyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgZnVuY3Rpb24gcmVuZGVyRmlsZXNJbkZvbGRlcihmb2xkZXIsIGZvbGRlckluZGV4KSB7CiAgICAgICAgICAgIGNvbnN0IGZpbGVzSW5Gb2xkZXIgPSBhc3NldEZpbGVzLmZpbHRlcihmaWxlID0+IGZpbGVUb0ZvbGRlck1hcHBpbmdbZmlsZS5uYW1lXSA9PT0gZm9sZGVyKTsKICAgICAgICAgICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYGZvbGRlckZpbGVzLSR7Zm9sZGVySW5kZXh9YCk7CiAgICAgICAgICAgIAogICAgICAgICAgICBpZiAoZmlsZXNJbkZvbGRlci5sZW5ndGggPT09IDApIHsKICAgICAgICAgICAgICAgIGNvbnRhaW5lci5pbm5lckhUTUwgPSAnPHAgY2xhc3M9InRleHQteHMgdGV4dC1ncmF5LTYwMCBpdGFsaWMiPk5vIGZpbGVzIGluIHRoaXMgZm9sZGVyIHlldDwvcD4nOwogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBjb250YWluZXIuaW5uZXJIVE1MID0gJyc7CiAgICAgICAgICAgIGZpbGVzSW5Gb2xkZXIuZm9yRWFjaChmaWxlID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IGZpbGVEaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKICAgICAgICAgICAgICAgIGZpbGVEaXYuY2xhc3NOYW1lID0gJ2ZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktYmV0d2VlbiBiZy1ncmF5LTgwMC81MCBweC0zIHB5LTIgcm91bmRlZCB0ZXh0LXhzJzsKICAgICAgICAgICAgICAgIGZpbGVEaXYuaW5uZXJIVE1MID0gYAogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZsZXggaXRlbXMtY2VudGVyIGZsZXgtMSI+CiAgICAgICAgICAgICAgICAgICAgICAgICR7Z2V0RmlsZUljb24oZmlsZS5uYW1lKX0KICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9InRleHQtZ3JheS0zMDAiPiR7ZmlsZS5uYW1lfTwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9InRleHQtZ3JheS02MDAgbWwtMiI+KCR7Zm9ybWF0RmlsZVNpemUoZmlsZS5zaXplKX0pPC9zcGFuPgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgIDxidXR0b24gb25jbGljaz0icmVtb3ZlRmlsZUZyb21Gb2xkZXIoJyR7ZmlsZS5uYW1lfScpIiBjbGFzcz0idGV4dC1yZWQtNDAwIGhvdmVyOnRleHQtcmVkLTMwMCI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtdGltZXMgdGV4dC14cyI+PC9pPgogICAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgICAgICAgICAgYDsKICAgICAgICAgICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChmaWxlRGl2KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIHdpbmRvdy5zZWxlY3RGaWxlc0ZvckZvbGRlciA9IGZ1bmN0aW9uKGZvbGRlcikgewogICAgICAgICAgICBjb25zdCBpbmRleCA9IGN1c3RvbUZvbGRlcnMuaW5kZXhPZihmb2xkZXIpOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChgZm9sZGVyVXBsb2FkLSR7aW5kZXh9YCkuY2xpY2soKTsKICAgICAgICB9OwogICAgICAgIAogICAgICAgIHdpbmRvdy5zZWxlY3RGb2xkZXJGb3JGb2xkZXIgPSBmdW5jdGlvbihmb2xkZXIpIHsKICAgICAgICAgICAgY29uc3QgaW5kZXggPSBjdXN0b21Gb2xkZXJzLmluZGV4T2YoZm9sZGVyKTsKICAgICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYGZvbGRlckRpclVwbG9hZC0ke2luZGV4fWApLmNsaWNrKCk7CiAgICAgICAgfTsKICAgICAgICAKICAgICAgICBmdW5jdGlvbiBoYW5kbGVGb2xkZXJTcGVjaWZpY1VwbG9hZChldmVudCwgdGFyZ2V0Rm9sZGVyKSB7CiAgICAgICAgICAgIGNvbnN0IGZpbGVzID0gQXJyYXkuZnJvbShldmVudC50YXJnZXQuZmlsZXMpOwogICAgICAgICAgICAKICAgICAgICAgICAgZmlsZXMuZm9yRWFjaChmaWxlID0+IHsKICAgICAgICAgICAgICAgIGlmIChmaWxlLm5hbWUuZW5kc1dpdGgoJy5odG1sJykpIHsKICAgICAgICAgICAgICAgICAgICBhbGVydChgIiR7ZmlsZS5uYW1lfSIgaXMgYW4gSFRNTCBmaWxlLiBQbGVhc2UgYWRkIGl0IHRvIHRoZSBNYWluIEhUTUwgRmlsZSBzZWN0aW9uLmApOwogICAgICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gQ2hlY2sgaWYgZmlsZSBhbHJlYWR5IGV4aXN0cwogICAgICAgICAgICAgICAgY29uc3QgZXhpc3RpbmdGaWxlSW5kZXggPSBhc3NldEZpbGVzLmZpbmRJbmRleChmID0+IGYubmFtZSA9PT0gZmlsZS5uYW1lKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgaWYgKGV4aXN0aW5nRmlsZUluZGV4ICE9PSAtMSkgewogICAgICAgICAgICAgICAgICAgIC8vIFVwZGF0ZSBleGlzdGluZyBmaWxlJ3MgZm9sZGVyIGFzc2lnbm1lbnQKICAgICAgICAgICAgICAgICAgICBmaWxlVG9Gb2xkZXJNYXBwaW5nW2ZpbGUubmFtZV0gPSB0YXJnZXRGb2xkZXI7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIC8vIEFkZCBuZXcgZmlsZSBhbmQgYXNzaWduIHRvIGZvbGRlcgogICAgICAgICAgICAgICAgICAgIGFzc2V0RmlsZXMucHVzaChmaWxlKTsKICAgICAgICAgICAgICAgICAgICBmaWxlVG9Gb2xkZXJNYXBwaW5nW2ZpbGUubmFtZV0gPSB0YXJnZXRGb2xkZXI7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAKICAgICAgICAgICAgcmVuZGVyQXNzZXRGaWxlcygpOwogICAgICAgICAgICByZW5kZXJGb2xkZXJzKCk7CiAgICAgICAgICAgIHVwZGF0ZVN0cnVjdHVyZVByZXZpZXcoKTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIFJlc2V0IGlucHV0CiAgICAgICAgICAgIGV2ZW50LnRhcmdldC52YWx1ZSA9ICcnOwogICAgICAgIH0KICAgICAgICAKICAgICAgICB3aW5kb3cucmVtb3ZlRmlsZUZyb21Gb2xkZXIgPSBmdW5jdGlvbihmaWxlTmFtZSkgewogICAgICAgICAgICBjb25zdCBmaWxlSW5kZXggPSBhc3NldEZpbGVzLmZpbmRJbmRleChmID0+IGYubmFtZSA9PT0gZmlsZU5hbWUpOwogICAgICAgICAgICBpZiAoZmlsZUluZGV4ICE9PSAtMSkgewogICAgICAgICAgICAgICAgYXNzZXRGaWxlcy5zcGxpY2UoZmlsZUluZGV4LCAxKTsKICAgICAgICAgICAgICAgIGRlbGV0ZSBmaWxlVG9Gb2xkZXJNYXBwaW5nW2ZpbGVOYW1lXTsKICAgICAgICAgICAgICAgIHJlbmRlckFzc2V0RmlsZXMoKTsKICAgICAgICAgICAgICAgIHJlbmRlckZvbGRlcnMoKTsKICAgICAgICAgICAgICAgIHVwZGF0ZVN0cnVjdHVyZVByZXZpZXcoKTsKICAgICAgICAgICAgfQogICAgICAgIH07CiAgICAgICAgCiAgICAgICAgZnVuY3Rpb24gY291bnRGaWxlc0luRm9sZGVyKGZvbGRlclBhdGgpIHsKICAgICAgICAgICAgcmV0dXJuIE9iamVjdC52YWx1ZXMoZmlsZVRvRm9sZGVyTWFwcGluZykuZmlsdGVyKHBhdGggPT4gcGF0aCA9PT0gZm9sZGVyUGF0aCkubGVuZ3RoOwogICAgICAgIH0KICAgICAgICAKICAgICAgICB3aW5kb3cucmVtb3ZlRm9sZGVyID0gZnVuY3Rpb24oaW5kZXgpIHsKICAgICAgICAgICAgY29uc3QgZm9sZGVyVG9SZW1vdmUgPSBjdXN0b21Gb2xkZXJzW2luZGV4XTsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIENoZWNrIGlmIHRoZXJlIGFyZSBzdWJmb2xkZXJzCiAgICAgICAgICAgIGNvbnN0IHN1YmZvbGRlcnMgPSBjdXN0b21Gb2xkZXJzLmZpbHRlcihmID0+IGYuc3RhcnRzV2l0aChmb2xkZXJUb1JlbW92ZSArICcvJykpOwogICAgICAgICAgICAKICAgICAgICAgICAgaWYgKHN1YmZvbGRlcnMubGVuZ3RoID4gMCkgewogICAgICAgICAgICAgICAgaWYgKCFjb25maXJtKGBUaGlzIGZvbGRlciBjb250YWlucyAke3N1YmZvbGRlcnMubGVuZ3RofSBzdWJmb2xkZXIocykuIEFsbCBzdWJmb2xkZXJzIGFuZCB0aGVpciBmaWxlcyB3aWxsIGJlIG1vdmVkIHRvIHJvb3QuIENvbnRpbnVlP2ApKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBBc2sgZm9yIGNvbmZpcm1hdGlvbiBpZiBmb2xkZXIgaGFzIGZpbGVzCiAgICAgICAgICAgIGNvbnN0IGZpbGVzSW5Gb2xkZXIgPSBjb3VudEZpbGVzSW5Gb2xkZXIoZm9sZGVyVG9SZW1vdmUpOwogICAgICAgICAgICBpZiAoZmlsZXNJbkZvbGRlciA+IDApIHsKICAgICAgICAgICAgICAgIGlmICghY29uZmlybShgVGhpcyBmb2xkZXIgY29udGFpbnMgJHtmaWxlc0luRm9sZGVyfSBmaWxlKHMpLiBGaWxlcyB3aWxsIGJlIG1vdmVkIHRvIHJvb3QuIENvbnRpbnVlP2ApKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBSZW1vdmUgZm9sZGVyIGFuZCBhbGwgaXRzIHN1YmZvbGRlcnMKICAgICAgICAgICAgY29uc3QgZm9sZGVyc1RvUmVtb3ZlID0gW2ZvbGRlclRvUmVtb3ZlLCAuLi5zdWJmb2xkZXJzXTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGZvbGRlcnNUb1JlbW92ZS5mb3JFYWNoKGZvbGRlciA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBpZHggPSBjdXN0b21Gb2xkZXJzLmluZGV4T2YoZm9sZGVyKTsKICAgICAgICAgICAgICAgIGlmIChpZHggIT09IC0xKSB7CiAgICAgICAgICAgICAgICAgICAgY3VzdG9tRm9sZGVycy5zcGxpY2UoaWR4LCAxKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgLy8gTW92ZSBmaWxlcyBmcm9tIGRlbGV0ZWQgZm9sZGVyIHRvIHJvb3QKICAgICAgICAgICAgICAgIE9iamVjdC5rZXlzKGZpbGVUb0ZvbGRlck1hcHBpbmcpLmZvckVhY2goZmlsZU5hbWUgPT4gewogICAgICAgICAgICAgICAgICAgIGlmIChmaWxlVG9Gb2xkZXJNYXBwaW5nW2ZpbGVOYW1lXSA9PT0gZm9sZGVyKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVUb0ZvbGRlck1hcHBpbmdbZmlsZU5hbWVdID0gJ3Jvb3QnOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KTsKICAgICAgICAgICAgCiAgICAgICAgICAgIHJlbmRlckZvbGRlcnMoKTsKICAgICAgICAgICAgcmVuZGVyQXNzZXRGaWxlcygpOwogICAgICAgICAgICB1cGRhdGVTdHJ1Y3R1cmVQcmV2aWV3KCk7CiAgICAgICAgfTsKICAgICAgICAKICAgICAgICB3aW5kb3cuYXNzaWduRmlsZVRvRm9sZGVyID0gZnVuY3Rpb24oZmlsZU5hbWUsIGZvbGRlclBhdGgpIHsKICAgICAgICAgICAgZmlsZVRvRm9sZGVyTWFwcGluZ1tmaWxlTmFtZV0gPSBmb2xkZXJQYXRoOwogICAgICAgICAgICB1cGRhdGVTdHJ1Y3R1cmVQcmV2aWV3KCk7CiAgICAgICAgfTsKICAgICAgICAKICAgICAgICB3aW5kb3cucmVtb3ZlSHRtbEZpbGUgPSBmdW5jdGlvbigpIHsKICAgICAgICAgICAgaHRtbEZpbGUgPSBudWxsOwogICAgICAgICAgICBlbGVtZW50cy5odG1sRmlsZUxpc3QuaW5uZXJIVE1MID0gJyc7CiAgICAgICAgICAgIGVsZW1lbnRzLmh0bWxGaWxlSW5wdXQudmFsdWUgPSAnJzsKICAgICAgICAgICAgdXBkYXRlU3RydWN0dXJlUHJldmlldygpOwogICAgICAgIH07CiAgICAgICAgCiAgICAgICAgd2luZG93LnJlbW92ZUFzc2V0RmlsZSA9IGZ1bmN0aW9uKGluZGV4KSB7CiAgICAgICAgICAgIGFzc2V0RmlsZXMuc3BsaWNlKGluZGV4LCAxKTsKICAgICAgICAgICAgcmVuZGVyQXNzZXRGaWxlcygpOwogICAgICAgICAgICB1cGRhdGVTdHJ1Y3R1cmVQcmV2aWV3KCk7CiAgICAgICAgfTsKICAgICAgICAKICAgICAgICBmdW5jdGlvbiBjbGVhckFsbCgpIHsKICAgICAgICAgICAgaHRtbEZpbGUgPSBudWxsOwogICAgICAgICAgICBhc3NldEZpbGVzID0gW107CiAgICAgICAgICAgIGN1c3RvbUZvbGRlcnMgPSBbXTsKICAgICAgICAgICAgZmlsZVRvRm9sZGVyTWFwcGluZyA9IHt9OwogICAgICAgICAgICBlbGVtZW50cy5odG1sRmlsZUxpc3QuaW5uZXJIVE1MID0gJyc7CiAgICAgICAgICAgIGVsZW1lbnRzLmFzc2V0c0ZpbGVMaXN0LmlubmVySFRNTCA9ICcnOwogICAgICAgICAgICBlbGVtZW50cy5odG1sRmlsZUlucHV0LnZhbHVlID0gJyc7CiAgICAgICAgICAgIGVsZW1lbnRzLmFzc2V0c0ZpbGVJbnB1dC52YWx1ZSA9ICcnOwogICAgICAgICAgICBlbGVtZW50cy5mb2xkZXJJbnB1dC52YWx1ZSA9ICcnOwogICAgICAgICAgICBlbGVtZW50cy5maWxlQ291bnQudGV4dENvbnRlbnQgPSAnJzsKICAgICAgICAgICAgcmVuZGVyRm9sZGVycygpOwogICAgICAgICAgICB1cGRhdGVTdHJ1Y3R1cmVQcmV2aWV3KCk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIC8vIEZpbGUgSWNvbiBIZWxwZXIKICAgICAgICBmdW5jdGlvbiBnZXRGaWxlSWNvbihmaWxlbmFtZSkgewogICAgICAgICAgICBjb25zdCBleHQgPSBmaWxlbmFtZS5zcGxpdCgnLicpLnBvcCgpLnRvTG93ZXJDYXNlKCk7CiAgICAgICAgICAgIGNvbnN0IGljb25zID0gewogICAgICAgICAgICAgICAgY3NzOiAnZmFiIGZhLWNzczMtYWx0IHRleHQtYmx1ZS00MDAgdGV4dC14bCBtbC0yIG1yLTInLAogICAgICAgICAgICAgICAganM6ICdmYWIgZmEtanMgdGV4dC15ZWxsb3ctNDAwIHRleHQteGwgbWwtMiBtci0yJywKICAgICAgICAgICAgICAgIHBuZzogJ2ZhciBmYS1pbWFnZSB0ZXh0LXB1cnBsZS00MDAgdGV4dC14bCBtbC0yIG1yLTInLAogICAgICAgICAgICAgICAganBnOiAnZmFyIGZhLWltYWdlIHRleHQtcHVycGxlLTQwMCB0ZXh0LXhsIG1sLTIgbXItMicsCiAgICAgICAgICAgICAgICBqcGVnOiAnZmFyIGZhLWltYWdlIHRleHQtcHVycGxlLTQwMCB0ZXh0LXhsIG1sLTIgbXItMicsCiAgICAgICAgICAgICAgICBnaWY6ICdmYXIgZmEtaW1hZ2UgdGV4dC1wdXJwbGUtNDAwIHRleHQteGwgbWwtMiBtci0yJywKICAgICAgICAgICAgICAgIHN2ZzogJ2ZhciBmYS1pbWFnZSB0ZXh0LXB1cnBsZS00MDAgdGV4dC14bCBtbC0yIG1yLTInLAogICAgICAgICAgICAgICAgd2VicDogJ2ZhciBmYS1pbWFnZSB0ZXh0LXB1cnBsZS00MDAgdGV4dC14bCBtbC0yIG1yLTInLAogICAgICAgICAgICAgICAgaWNvOiAnZmFyIGZhLWltYWdlIHRleHQtcHVycGxlLTQwMCB0ZXh0LXhsIG1sLTIgbXItMicsCiAgICAgICAgICAgICAgICBqc29uOiAnZmFzIGZhLWZpbGUtY29kZSB0ZXh0LW9yYW5nZS00MDAgdGV4dC14bCBtbC0yIG1yLTInLAogICAgICAgICAgICAgICAgdHh0OiAnZmFyIGZhLWZpbGUtbGluZXMgdGV4dC1ncmF5LTQwMCB0ZXh0LXhsIG1sLTIgbXItMicsCiAgICAgICAgICAgICAgICBwZGY6ICdmYXIgZmEtZmlsZS1wZGYgdGV4dC1yZWQtNDAwIHRleHQteGwgbWwtMiBtci0yJywKICAgICAgICAgICAgICAgIG1kOiAnZmFiIGZhLW1hcmtkb3duIHRleHQtYmx1ZS00MDAgdGV4dC14bCBtbC0yIG1yLTInLAogICAgICAgICAgICAgICAgd29mZjogJ2ZhcyBmYS1mb250IHRleHQtZ3JheS00MDAgdGV4dC14bCBtbC0yIG1yLTInLAogICAgICAgICAgICAgICAgd29mZjI6ICdmYXMgZmEtZm9udCB0ZXh0LWdyYXktNDAwIHRleHQteGwgbWwtMiBtci0yJywKICAgICAgICAgICAgICAgIHR0ZjogJ2ZhcyBmYS1mb250IHRleHQtZ3JheS00MDAgdGV4dC14bCBtbC0yIG1yLTInLAogICAgICAgICAgICAgICAgb3RmOiAnZmFzIGZhLWZvbnQgdGV4dC1ncmF5LTQwMCB0ZXh0LXhsIG1sLTIgbXItMicKICAgICAgICAgICAgfTsKICAgICAgICAgICAgcmV0dXJuIGA8aSBjbGFzcz0iJHtpY29uc1tleHRdIHx8ICdmYXIgZmEtZmlsZSB0ZXh0LWdyYXktNTAwIHRleHQteGwgbXItMyd9Ij48L2k+YDsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgZnVuY3Rpb24gZm9ybWF0RmlsZVNpemUoYnl0ZXMpIHsKICAgICAgICAgICAgaWYgKGJ5dGVzID09PSAwKSByZXR1cm4gJzAgQnl0ZXMnOwogICAgICAgICAgICBjb25zdCBrID0gMTAyNDsKICAgICAgICAgICAgY29uc3Qgc2l6ZXMgPSBbJ0J5dGVzJywgJ0tCJywgJ01CJywgJ0dCJ107CiAgICAgICAgICAgIGNvbnN0IGkgPSBNYXRoLmZsb29yKE1hdGgubG9nKGJ5dGVzKSAvIE1hdGgubG9nKGspKTsKICAgICAgICAgICAgcmV0dXJuIE1hdGgucm91bmQoKGJ5dGVzIC8gTWF0aC5wb3coaywgaSkpICogMTAwKSAvIDEwMCArICcgJyArIHNpemVzW2ldOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAvLyBTdHJ1Y3R1cmUgUHJldmlldwogICAgICAgIGZ1bmN0aW9uIHVwZGF0ZVN0cnVjdHVyZVByZXZpZXcoKSB7CiAgICAgICAgICAgIGNvbnN0IHNpdGVOYW1lID0gZWxlbWVudHMuc2l0ZU5hbWVJbnB1dC52YWx1ZSB8fCAnd2Vic2l0ZS1uYW1lJzsKICAgICAgICAgICAgZWxlbWVudHMuc2l0ZUZvbGRlclByZXZpZXcudGV4dENvbnRlbnQgPSBzaXRlTmFtZTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGxldCBmaWxlc0hUTUwgPSAnJzsKICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIFNob3cgaW5kZXguaHRtbAogICAgICAgICAgICBpZiAoaHRtbEZpbGUpIHsKICAgICAgICAgICAgICAgIGZpbGVzSFRNTCArPSBgCiAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxleCBpdGVtcy1jZW50ZXIgcHktMSI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJ0ZXh0LWdyYXktNTAwIj7ilJzilIAgPC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFiIGZhLWh0bWw1IHRleHQtb3JhbmdlLTQwMCBteC0yIj48L2k+CiAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJ0ZXh0LWJsdWUtMzAwIj5pbmRleC5odG1sPC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz0idGV4dC1ncmF5LTUwMCB0ZXh0LXhzIG1sLTIiPigke2Zvcm1hdEZpbGVTaXplKGh0bWxGaWxlLnNpemUpfSk8L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICBgOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBTb3J0IGZvbGRlcnMgdG8gc2hvdyBoaWVyYXJjaHkgcHJvcGVybHkKICAgICAgICAgICAgY29uc3Qgc29ydGVkRm9sZGVycyA9IFsuLi5jdXN0b21Gb2xkZXJzXS5zb3J0KChhLCBiKSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBhRGVwdGggPSAoYS5tYXRjaCgvXC8vZykgfHwgW10pLmxlbmd0aDsKICAgICAgICAgICAgICAgIGNvbnN0IGJEZXB0aCA9IChiLm1hdGNoKC9cLy9nKSB8fCBbXSkubGVuZ3RoOwogICAgICAgICAgICAgICAgaWYgKGFEZXB0aCAhPT0gYkRlcHRoKSByZXR1cm4gYURlcHRoIC0gYkRlcHRoOwogICAgICAgICAgICAgICAgcmV0dXJuIGEubG9jYWxlQ29tcGFyZShiKTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBTaG93IGN1c3RvbSBmb2xkZXJzIGFuZCB0aGVpciBmaWxlcwogICAgICAgICAgICBzb3J0ZWRGb2xkZXJzLmZvckVhY2goKGZvbGRlciwgZm9sZGVySW5kZXgpID0+IHsKICAgICAgICAgICAgICAgIGNvbnN0IGZpbGVzSW5Gb2xkZXIgPSBhc3NldEZpbGVzLmZpbHRlcihmaWxlID0+IGZpbGVUb0ZvbGRlck1hcHBpbmdbZmlsZS5uYW1lXSA9PT0gZm9sZGVyKTsKICAgICAgICAgICAgICAgIGNvbnN0IGRlcHRoID0gKGZvbGRlci5tYXRjaCgvXC8vZykgfHwgW10pLmxlbmd0aDsKICAgICAgICAgICAgICAgIGNvbnN0IGluZGVudCA9ICcgICAgJy5yZXBlYXQoZGVwdGgpOwogICAgICAgICAgICAgICAgY29uc3QgZm9sZGVyTmFtZSA9IGZvbGRlci5zcGxpdCgnLycpLnBvcCgpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBmaWxlc0hUTUwgKz0gYAogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZsZXggaXRlbXMtY2VudGVyIHB5LTEiIHN0eWxlPSJtYXJnaW4tbGVmdDogJHtkZXB0aCAqIDE2fXB4Ij4KICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9InRleHQtZ3JheS01MDAiPuKUnOKUgCA8L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtZm9sZGVyLW9wZW4gdGV4dC15ZWxsb3ctNDAwIG14LTIiPjwvaT4KICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9InRleHQteWVsbG93LTMwMCI+JHtmb2xkZXJOYW1lfS88L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJ0ZXh0LWdyYXktNTAwIHRleHQteHMgbWwtMiI+KCR7ZmlsZXNJbkZvbGRlci5sZW5ndGh9IGZpbGVzKTwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIGA7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIC8vIFNob3cgZmlsZXMgaW4gdGhpcyBmb2xkZXIKICAgICAgICAgICAgICAgIGZpbGVzSW5Gb2xkZXIuZm9yRWFjaCgoZmlsZSwgZmlsZUluZGV4KSA9PiB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgaXNMYXN0ID0gZmlsZUluZGV4ID09PSBmaWxlc0luRm9sZGVyLmxlbmd0aCAtIDE7CiAgICAgICAgICAgICAgICAgICAgZmlsZXNIVE1MICs9IGAKICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iZmxleCBpdGVtcy1jZW50ZXIgcHktMSIgc3R5bGU9Im1hcmdpbi1sZWZ0OiAkeyhkZXB0aCArIDEpICogMTZ9cHgiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9InRleHQtZ3JheS01MDAiPiR7aXNMYXN0ID8gJ+KUlOKUgCcgOiAn4pSc4pSAJ30gPC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgJHtnZXRGaWxlSWNvbihmaWxlLm5hbWUpfQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9InRleHQtZ3JheS0zMDAiPiR7ZmlsZS5uYW1lfTwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJ0ZXh0LWdyYXktNTAwIHRleHQteHMgbWwtMiI+KCR7Zm9ybWF0RmlsZVNpemUoZmlsZS5zaXplKX0pPC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICBgOwogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgICAKICAgICAgICAgICAgLy8gU2hvdyBmaWxlcyBpbiByb290IChub3QgYXNzaWduZWQgdG8gYW55IGZvbGRlcikKICAgICAgICAgICAgY29uc3Qgcm9vdEZpbGVzID0gYXNzZXRGaWxlcy5maWx0ZXIoZmlsZSA9PiAhZmlsZVRvRm9sZGVyTWFwcGluZ1tmaWxlLm5hbWVdIHx8IGZpbGVUb0ZvbGRlck1hcHBpbmdbZmlsZS5uYW1lXSA9PT0gJ3Jvb3QnKTsKICAgICAgICAgICAgcm9vdEZpbGVzLmZvckVhY2goKGZpbGUsIGluZGV4KSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBpc0xhc3QgPSBpbmRleCA9PT0gcm9vdEZpbGVzLmxlbmd0aCAtIDEgJiYgc29ydGVkRm9sZGVycy5sZW5ndGggPT09IDAgJiYgIWh0bWxGaWxlOwogICAgICAgICAgICAgICAgZmlsZXNIVE1MICs9IGAKICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmbGV4IGl0ZW1zLWNlbnRlciBweS0xIj4KICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9InRleHQtZ3JheS01MDAiPiR7aXNMYXN0ID8gJ+KUlOKUgCcgOiAn4pSc4pSAJ30gPC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAke2dldEZpbGVJY29uKGZpbGUubmFtZSl9CiAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJ0ZXh0LWdyYXktMzAwIj4ke2ZpbGUubmFtZX08L3NwYW4+CiAgICAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPSJ0ZXh0LWdyYXktNTAwIHRleHQteHMgbWwtMiI+KCR7Zm9ybWF0RmlsZVNpemUoZmlsZS5zaXplKX0pPC9zcGFuPgogICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgYDsKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBlbGVtZW50cy5maWxlc1ByZXZpZXcuaW5uZXJIVE1MID0gZmlsZXNIVE1MIHx8ICc8ZGl2IGNsYXNzPSJ0ZXh0LWdyYXktNTAwIj5ObyBmaWxlcyBhZGRlZCB5ZXQ8L2Rpdj4nOwogICAgICAgIH0KICAgICAgICAKICAgICAgICAvLyBQcm9ncmVzcwogICAgICAgIGZ1bmN0aW9uIHVwZGF0ZVByb2dyZXNzKHBlcmNlbnQsIG1lc3NhZ2UpIHsKICAgICAgICAgICAgZWxlbWVudHMucHJvZ3Jlc3NDb250YWluZXIuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CiAgICAgICAgICAgIGVsZW1lbnRzLnByb2dyZXNzQmFyLnN0eWxlLndpZHRoID0gcGVyY2VudCArICclJzsKICAgICAgICAgICAgZWxlbWVudHMucHJvZ3Jlc3NUZXh0LnRleHRDb250ZW50ID0gbWVzc2FnZTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgZnVuY3Rpb24gaGlkZVByb2dyZXNzKCkgewogICAgICAgICAgICBlbGVtZW50cy5wcm9ncmVzc0NvbnRhaW5lci5jbGFzc0xpc3QuYWRkKCdoaWRkZW4nKTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLy8gRGVwbG95IEZ1bmN0aW9uCiAgICAgICAgYXN5bmMgZnVuY3Rpb24gZGVwbG95KCkgewogICAgICAgICAgICBjb25zdCBzaXRlTmFtZSA9IGVsZW1lbnRzLnNpdGVOYW1lSW5wdXQudmFsdWUudHJpbSgpOwogICAgICAgICAgICAKICAgICAgICAgICAgaWYgKCFzaXRlTmFtZSkgewogICAgICAgICAgICAgICAgc2hvd1Jlc3VsdCgn4pqg77iPIFBsZWFzZSBlbnRlciBhIHdlYnNpdGUgZm9sZGVyIG5hbWUuJywgJ2Vycm9yJyk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIGlmICghaHRtbEZpbGUpIHsKICAgICAgICAgICAgICAgIHNob3dSZXN1bHQoJ+KaoO+4jyBQbGVhc2UgYWRkIGFuIEhUTUwgZmlsZSB0byBkZXBsb3kuJywgJ2Vycm9yJyk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIGVsZW1lbnRzLmRlcGxveUJ0bi5pbm5lckhUTUwgPSAnPGkgY2xhc3M9ImZhcyBmYS1zcGlubmVyIGZhLXNwaW4gbXItMiI+PC9pPiBEZXBsb3lpbmcuLi4nOwogICAgICAgICAgICBlbGVtZW50cy5kZXBsb3lCdG4uZGlzYWJsZWQgPSB0cnVlOwogICAgICAgICAgICAKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHVwZGF0ZVByb2dyZXNzKDEwLCAnQ2hlY2tpbmcgcmVwb3NpdG9yeS4uLicpOwogICAgICAgICAgICAgICAgYXdhaXQgY3JlYXRlT3JHZXRSZXBvc2l0b3J5KCk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHVwZGF0ZVByb2dyZXNzKDMwLCAnVXBsb2FkaW5nIGZpbGVzLi4uJyk7CiAgICAgICAgICAgICAgICBhd2FpdCB1cGxvYWRGaWxlcyhzaXRlTmFtZSk7CiAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgIHVwZGF0ZVByb2dyZXNzKDcwLCAnRW5hYmxpbmcgR2l0SHViIFBhZ2VzLi4uJyk7CiAgICAgICAgICAgICAgICBhd2FpdCBlbmFibGVQYWdlcygpOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB1cGRhdGVQcm9ncmVzcyg5MCwgJ0dlbmVyYXRpbmcgVVJMLi4uJyk7CiAgICAgICAgICAgICAgICBjb25zdCBwYWdlc1VybCA9IGF3YWl0IGdldFBhZ2VzVXJsKHNpdGVOYW1lKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgdXBkYXRlUHJvZ3Jlc3MoMTAwLCAnRGVwbG95bWVudCBjb21wbGV0ZSEnKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgaGlkZVByb2dyZXNzKCk7CiAgICAgICAgICAgICAgICAgICAgc2hvd1Jlc3VsdChgCiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InNwYWNlLXktNCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJmbGV4IGl0ZW1zLWNlbnRlciB0ZXh0LWdyZWVuLTQwMCBmb250LW1lZGl1bSB0ZXh0LWxnIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLWNoZWNrLWNpcmNsZSBtci0yIHRleHQtMnhsIj48L2k+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgU3VjY2Vzc2Z1bGx5IGRlcGxveWVkIQogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJiZy1ncmFkaWVudC10by1yIGZyb20tYmx1ZS01MDAvMTAgdG8tcHVycGxlLTUwMC8xMCBwLTYgcm91bmRlZC1sZyBib3JkZXIgYm9yZGVyLWJsdWUtNTAwLzMwIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8cCBjbGFzcz0iZm9udC1tZWRpdW0gbWItMyB0ZXh0LWdyYXktMzAwIj5Zb3VyIHNpdGUgaXMgbGl2ZSBhdDo8L3A+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGEgaHJlZj0iJHtwYWdlc1VybH0iIHRhcmdldD0iX2JsYW5rIiBjbGFzcz0idGV4dC1ibHVlLTQwMCBob3Zlcjp0ZXh0LWJsdWUtMzAwIHVuZGVybGluZSBicmVhay1hbGwgdGV4dC1sZyBmb250LXNlbWlib2xkIGZsZXggaXRlbXMtY2VudGVyIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHtwYWdlc1VybH0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS1leHRlcm5hbC1saW5rLWFsdCBtbC0yIHRleHQtc20iPjwvaT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2E+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGJ1dHRvbiBvbmNsaWNrPSJ3aW5kb3cub3BlbignJHtwYWdlc1VybH0nLCAnX2JsYW5rJykiIGNsYXNzPSJtdC00IGJnLWJsdWUtNTAwIGhvdmVyOmJnLWJsdWUtNjAwIHRleHQtd2hpdGUgcHgtNiBweS0zIHJvdW5kZWQtbGcgZm9udC1tZWRpdW0gdHJhbnNpdGlvbiB3LWZ1bGwiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLXJvY2tldCBtci0yIj48L2k+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFZpc2l0IFlvdXIgU2l0ZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvYnV0dG9uPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJnbGFzcy1jYXJkIHAtNiByb3VuZGVkLWxnIGJvcmRlciBib3JkZXItZ3JheS03MDAiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxwIGNsYXNzPSJmb250LW1lZGl1bSBtYi0zIHRleHQtZ3JheS0zMDAiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLWluZm8tY2lyY2xlIHRleHQtYmx1ZS00MDAgbXItMiI+PC9pPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBEZXBsb3ltZW50IERldGFpbHM6CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9wPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDx1bCBjbGFzcz0ic3BhY2UteS0yIHRleHQtc20gdGV4dC1ncmF5LTQwMCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxsaSBjbGFzcz0iZmxleCBpdGVtcy1zdGFydCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLWZvbGRlciB0ZXh0LXllbGxvdy00MDAgbXItMiBtdC0xIj48L2k+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3Bhbj48c3Ryb25nIGNsYXNzPSJ0ZXh0LWdyYXktMzAwIj5TaXRlIEZvbGRlcjo8L3N0cm9uZz4gPGNvZGUgY2xhc3M9ImJnLWdyYXktODAwIHB4LTIgcHktMSByb3VuZGVkIHRleHQtYmx1ZS0zMDAiPnB1YmxpYy8ke3NpdGVOYW1lfS88L2NvZGU+PC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2xpPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8bGkgY2xhc3M9ImZsZXggaXRlbXMtc3RhcnQiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9ImZhYiBmYS1odG1sNSB0ZXh0LW9yYW5nZS00MDAgbXItMiBtdC0xIj48L2k+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8c3Bhbj48c3Ryb25nIGNsYXNzPSJ0ZXh0LWdyYXktMzAwIj5NYWluIEhUTUw6PC9zdHJvbmc+IDxjb2RlIGNsYXNzPSJiZy1ncmF5LTgwMCBweC0yIHB5LTEgcm91bmRlZCB0ZXh0LWJsdWUtMzAwIj4ke2h0bWxGaWxlLm5hbWV9PC9jb2RlPiDihpIgPGNvZGUgY2xhc3M9ImJnLWdyYXktODAwIHB4LTIgcHktMSByb3VuZGVkIHRleHQtYmx1ZS0zMDAiPmluZGV4Lmh0bWw8L2NvZGU+PC9zcGFuPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2xpPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8bGkgY2xhc3M9ImZsZXggaXRlbXMtc3RhcnQiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS1maWxlIHRleHQtZ3JlZW4tNDAwIG1yLTIgbXQtMSI+PC9pPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4+PHN0cm9uZyBjbGFzcz0idGV4dC1ncmF5LTMwMCI+QWRkaXRpb25hbCBGaWxlczo8L3N0cm9uZz4gJHthc3NldEZpbGVzLmxlbmd0aH0gZmlsZShzKTwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9saT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGxpIGNsYXNzPSJmbGV4IGl0ZW1zLXN0YXJ0Ij4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxpIGNsYXNzPSJmYXMgZmEtY2xvY2sgdGV4dC1wdXJwbGUtNDAwIG1yLTIgbXQtMSI+PC9pPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHNwYW4+PHN0cm9uZyBjbGFzcz0idGV4dC1ncmF5LTMwMCI+RGVwbG95ZWQ6PC9zdHJvbmc+ICR7bmV3IERhdGUoKS50b0xvY2FsZVN0cmluZygpfTwvc3Bhbj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9saT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3VsPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJiZy15ZWxsb3ctNTAwLzEwIHAtNCByb3VuZGVkLWxnIGJvcmRlciBib3JkZXIteWVsbG93LTUwMC8zMCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3M9InRleHQtc20gdGV4dC15ZWxsb3ctMzAwIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgPGkgY2xhc3M9ImZhcyBmYS1jbG9jayBtci0yIj48L2k+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxzdHJvbmc+Tm90ZTo8L3N0cm9uZz4gSXQgbWF5IHRha2UgMS0yIG1pbnV0ZXMgZm9yIHlvdXIgc2l0ZSB0byBiZSBmdWxseSBhY2Nlc3NpYmxlLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvcD4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICBgLCAnc3VjY2VzcycpOwogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIGdzYXAuZnJvbSgnI3Jlc3VsdHMnLCB7IGR1cmF0aW9uOiAwLjUsIHNjYWxlOiAwLjksIG9wYWNpdHk6IDAgfSk7CiAgICAgICAgICAgICAgICB9LCA1MDApOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgICAgICBoaWRlUHJvZ3Jlc3MoKTsKICAgICAgICAgICAgICAgIHNob3dSZXN1bHQoYAogICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9InNwYWNlLXktMyI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9ImZsZXggaXRlbXMtY2VudGVyIHRleHQtcmVkLTQwMCBmb250LW1lZGl1bSI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8aSBjbGFzcz0iZmFzIGZhLWV4Y2xhbWF0aW9uLWNpcmNsZSBtci0yIj48L2k+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBEZXBsb3ltZW50IGZhaWxlZAogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0iYmctcmVkLTUwMC8xMCBwLTQgcm91bmRlZC1sZyBib3JkZXIgYm9yZGVyLXJlZC01MDAvMzAiPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHAgY2xhc3M9InRleHQtc20gdGV4dC1yZWQtMzAwIj4ke2Vycm9yLm1lc3NhZ2V9PC9wPgogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0idGV4dC1zbSB0ZXh0LWdyYXktNDAwIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxwIGNsYXNzPSJmb250LW1lZGl1bSBtYi0yIHRleHQtZ3JheS0zMDAiPkNvbW1vbiBpc3N1ZXM6PC9wPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPHVsIGNsYXNzPSJsaXN0LWRpc2MgbGlzdC1pbnNpZGUgc3BhY2UteS0xIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8bGk+SW52YWxpZCBHaXRIdWIgdG9rZW48L2xpPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxsaT5SZXBvc2l0b3J5IGRvZXNuJ3QgZXhpc3Qgb3Igbm8gYWNjZXNzPC9saT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8bGk+TmV0d29yayBjb25uZWN0aW9uIHByb2JsZW1zPC9saT4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8bGk+RmlsZSBzaXplIGxpbWl0cyBleGNlZWRlZDwvbGk+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L3VsPgogICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgIGAsICdlcnJvcicpOwogICAgICAgICAgICB9IGZpbmFsbHkgewogICAgICAgICAgICAgICAgZWxlbWVudHMuZGVwbG95QnRuLmlubmVySFRNTCA9ICc8aSBjbGFzcz0iZmFzIGZhLXJvY2tldCBtci0yIj48L2k+IERlcGxveSB0byBHaXRIdWIgUGFnZXMnOwogICAgICAgICAgICAgICAgZWxlbWVudHMuZGVwbG95QnRuLmRpc2FibGVkID0gZmFsc2U7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLy8gR2l0SHViIEFQSSBGdW5jdGlvbnMKICAgICAgICBhc3luYyBmdW5jdGlvbiBnZXRVc2VybmFtZSgpIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goJ2h0dHBzOi8vYXBpLmdpdGh1Yi5jb20vdXNlcicsIHsKICAgICAgICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICAgICAgICAgICdBdXRob3JpemF0aW9uJzogYHRva2VuICR7R0lUSFVCX1RPS0VOfWAsCiAgICAgICAgICAgICAgICAgICAgICAgICdBY2NlcHQnOiAnYXBwbGljYXRpb24vdm5kLmdpdGh1Yi52Mytqc29uJwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBpZiAoIXJlc3BvbnNlLm9rKSB7CiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbnZhbGlkIEdpdEh1YiB0b2tlbi4gUGxlYXNlIGNoZWNrIHlvdXIgY29uZmlndXJhdGlvbi4nKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgY29uc3QgdXNlckRhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7CiAgICAgICAgICAgICAgICByZXR1cm4gdXNlckRhdGEubG9naW47CiAgICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ZhaWxlZCB0byBhdXRoZW50aWNhdGUgd2l0aCBHaXRIdWIuIFBsZWFzZSBjaGVjayB5b3VyIHRva2VuLicpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGFzeW5jIGZ1bmN0aW9uIGNyZWF0ZU9yR2V0UmVwb3NpdG9yeSgpIHsKICAgICAgICAgICAgY29uc3QgdXNlcm5hbWUgPSBhd2FpdCBnZXRVc2VybmFtZSgpOwogICAgICAgICAgICAKICAgICAgICAgICAgY29uc3QgZ2V0UmVzcG9uc2UgPSBhd2FpdCBmZXRjaChgaHR0cHM6Ly9hcGkuZ2l0aHViLmNvbS9yZXBvcy8ke3VzZXJuYW1lfS8ke1JFUE9TSVRPUllfTkFNRX1gLCB7CiAgICAgICAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICAgICAgICAgJ0F1dGhvcml6YXRpb24nOiBgdG9rZW4gJHtHSVRIVUJfVE9LRU59YCwKICAgICAgICAgICAgICAgICAgICAnQWNjZXB0JzogJ2FwcGxpY2F0aW9uL3ZuZC5naXRodWIudjMranNvbicKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBpZiAoZ2V0UmVzcG9uc2Uub2spIHsKICAgICAgICAgICAgICAgIHJldHVybiBhd2FpdCBnZXRSZXNwb25zZS5qc29uKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIGNvbnN0IGNyZWF0ZVJlc3BvbnNlID0gYXdhaXQgZmV0Y2goJ2h0dHBzOi8vYXBpLmdpdGh1Yi5jb20vdXNlci9yZXBvcycsIHsKICAgICAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLAogICAgICAgICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAgICAgICAgICdBdXRob3JpemF0aW9uJzogYHRva2VuICR7R0lUSFVCX1RPS0VOfWAsCiAgICAgICAgICAgICAgICAgICAgJ0FjY2VwdCc6ICdhcHBsaWNhdGlvbi92bmQuZ2l0aHViLnYzK2pzb24nLAogICAgICAgICAgICAgICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicKICAgICAgICAgICAgICAgIH0sCiAgICAgICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7CiAgICAgICAgICAgICAgICAgICAgbmFtZTogUkVQT1NJVE9SWV9OQU1FLAogICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAnRGVwbG95ZWQgdmlhIEdpdEh1YiBIVE1MIERlcGxveWVyIFBybycsCiAgICAgICAgICAgICAgICAgICAgcHJpdmF0ZTogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgYXV0b19pbml0OiB0cnVlCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICB9KTsKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmICghY3JlYXRlUmVzcG9uc2Uub2spIHsKICAgICAgICAgICAgICAgIGNvbnN0IGVycm9yID0gYXdhaXQgY3JlYXRlUmVzcG9uc2UuanNvbigpOwogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGVycm9yLm1lc3NhZ2UgfHwgJ0ZhaWxlZCB0byBjcmVhdGUgcmVwb3NpdG9yeScpOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICBhd2FpdCBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgMjAwMCkpOwogICAgICAgICAgICByZXR1cm4gYXdhaXQgY3JlYXRlUmVzcG9uc2UuanNvbigpOwogICAgICAgIH0KICAgICAgICAKICAgICAgICBhc3luYyBmdW5jdGlvbiB1cGxvYWRGaWxlcyhzaXRlTmFtZSkgewogICAgICAgICAgICBjb25zdCBiYXNlUGF0aCA9IGBwdWJsaWMvJHtzaXRlTmFtZX1gOwogICAgICAgICAgICBjb25zdCB0b3RhbEZpbGVzID0gMSArIGFzc2V0RmlsZXMubGVuZ3RoOwogICAgICAgICAgICBsZXQgdXBsb2FkZWRGaWxlcyA9IDA7CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBVcGxvYWQgSFRNTCBmaWxlCiAgICAgICAgICAgIGlmIChodG1sRmlsZSkgewogICAgICAgICAgICAgICAgYXdhaXQgdXBsb2FkRmlsZShgJHtiYXNlUGF0aH0vaW5kZXguaHRtbGAsIGh0bWxGaWxlKTsKICAgICAgICAgICAgICAgIHVwbG9hZGVkRmlsZXMrKzsKICAgICAgICAgICAgICAgIHVwZGF0ZVByb2dyZXNzKDMwICsgKHVwbG9hZGVkRmlsZXMgLyB0b3RhbEZpbGVzKSAqIDQwLCBgVXBsb2FkaW5nIGZpbGVzLi4uICgke3VwbG9hZGVkRmlsZXN9LyR7dG90YWxGaWxlc30pYCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIC8vIENyZWF0ZSBmb2xkZXJzIGZpcnN0IChjcmVhdGUgZW1wdHkgLmdpdGtlZXAgZmlsZXMgdG8gZW5zdXJlIGZvbGRlcnMgZXhpc3QpCiAgICAgICAgICAgIGZvciAoY29uc3QgZm9sZGVyIG9mIGN1c3RvbUZvbGRlcnMpIHsKICAgICAgICAgICAgICAgIGNvbnN0IGdpdGtlZXBDb250ZW50ID0gYnRvYSgnIyBUaGlzIGZpbGUga2VlcHMgdGhlIGZvbGRlciBpbiBnaXQnKTsKICAgICAgICAgICAgICAgIGNvbnN0IHVzZXJuYW1lID0gYXdhaXQgZ2V0VXNlcm5hbWUoKTsKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgYXdhaXQgZmV0Y2goYGh0dHBzOi8vYXBpLmdpdGh1Yi5jb20vcmVwb3MvJHt1c2VybmFtZX0vJHtSRVBPU0lUT1JZX05BTUV9L2NvbnRlbnRzLyR7YmFzZVBhdGh9LyR7Zm9sZGVyfS8uZ2l0a2VlcGAsIHsKICAgICAgICAgICAgICAgICAgICBtZXRob2Q6ICdQVVQnLAogICAgICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgICAgICAgICAgJ0F1dGhvcml6YXRpb24nOiBgdG9rZW4gJHtHSVRIVUJfVE9LRU59YCwKICAgICAgICAgICAgICAgICAgICAgICAgJ0FjY2VwdCc6ICdhcHBsaWNhdGlvbi92bmQuZ2l0aHViLnYzK2pzb24nLAogICAgICAgICAgICAgICAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nCiAgICAgICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7CiAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IGBDcmVhdGUgZm9sZGVyICR7Zm9sZGVyfWAsCiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRlbnQ6IGdpdGtlZXBDb250ZW50CiAgICAgICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIAogICAgICAgICAgICAvLyBVcGxvYWQgYXNzZXQgZmlsZXMgdG8gdGhlaXIgYXNzaWduZWQgZm9sZGVycwogICAgICAgICAgICBmb3IgKGNvbnN0IGZpbGUgb2YgYXNzZXRGaWxlcykgewogICAgICAgICAgICAgICAgY29uc3QgZm9sZGVyUGF0aCA9IGZpbGVUb0ZvbGRlck1hcHBpbmdbZmlsZS5uYW1lXTsKICAgICAgICAgICAgICAgIGNvbnN0IGZpbGVQYXRoID0gZm9sZGVyUGF0aCAmJiBmb2xkZXJQYXRoICE9PSAncm9vdCcgPwogICAgICAgICAgICAgICAgICAgIGAke2Jhc2VQYXRofS8ke2ZvbGRlclBhdGh9LyR7ZmlsZS5uYW1lfWAgOgogICAgICAgICAgICAgICAgICAgIGAke2Jhc2VQYXRofS8ke2ZpbGUubmFtZX1gOwogICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICBhd2FpdCB1cGxvYWRGaWxlKGZpbGVQYXRoLCBmaWxlKTsKICAgICAgICAgICAgICAgIHVwbG9hZGVkRmlsZXMrKzsKICAgICAgICAgICAgICAgIHVwZGF0ZVByb2dyZXNzKDMwICsgKHVwbG9hZGVkRmlsZXMgLyB0b3RhbEZpbGVzKSAqIDQwLCBgVXBsb2FkaW5nIGZpbGVzLi4uICgke3VwbG9hZGVkRmlsZXN9LyR7dG90YWxGaWxlc30pYCk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgYXN5bmMgZnVuY3Rpb24gdXBsb2FkRmlsZShwYXRoLCBmaWxlKSB7CiAgICAgICAgICAgIGNvbnN0IHVzZXJuYW1lID0gYXdhaXQgZ2V0VXNlcm5hbWUoKTsKICAgICAgICAgICAgY29uc3QgY29udGVudCA9IGF3YWl0IHJlYWRGaWxlQXNCYXNlNjQoZmlsZSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKGBodHRwczovL2FwaS5naXRodWIuY29tL3JlcG9zLyR7dXNlcm5hbWV9LyR7UkVQT1NJVE9SWV9OQU1FfS9jb250ZW50cy8ke3BhdGh9YCwgewogICAgICAgICAgICAgICAgbWV0aG9kOiAnUFVUJywKICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgICAgICAnQXV0aG9yaXphdGlvbic6IGB0b2tlbiAke0dJVEhVQl9UT0tFTn1gLAogICAgICAgICAgICAgICAgICAgICdBY2NlcHQnOiAnYXBwbGljYXRpb24vdm5kLmdpdGh1Yi52Mytqc29uJywKICAgICAgICAgICAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoewogICAgICAgICAgICAgICAgICAgIG1lc3NhZ2U6IGBEZXBsb3kgJHtwYXRofWAsCiAgICAgICAgICAgICAgICAgICAgY29udGVudDogY29udGVudAogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBpZiAoIXJlc3BvbnNlLm9rKSB7CiAgICAgICAgICAgICAgICBjb25zdCBlcnJvciA9IGF3YWl0IHJlc3BvbnNlLmpzb24oKTsKICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgRmFpbGVkIHRvIHVwbG9hZCAke3BhdGh9OiAke2Vycm9yLm1lc3NhZ2V9YCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgCiAgICAgICAgICAgIHJldHVybiBhd2FpdCByZXNwb25zZS5qc29uKCk7CiAgICAgICAgfQogICAgICAgIAogICAgICAgIGZ1bmN0aW9uIHJlYWRGaWxlQXNCYXNlNjQoZmlsZSkgewogICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gewogICAgICAgICAgICAgICAgY29uc3QgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTsKICAgICAgICAgICAgICAgIHJlYWRlci5vbmxvYWQgPSAoKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgY29uc3QgYmFzZTY0ID0gcmVhZGVyLnJlc3VsdC5zcGxpdCgnLCcpWzFdOwogICAgICAgICAgICAgICAgICAgIHJlc29sdmUoYmFzZTY0KTsKICAgICAgICAgICAgICAgIH07CiAgICAgICAgICAgICAgICByZWFkZXIub25lcnJvciA9IHJlamVjdDsKICAgICAgICAgICAgICAgIHJlYWRlci5yZWFkQXNEYXRhVVJMKGZpbGUpOwogICAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgYXN5bmMgZnVuY3Rpb24gZW5hYmxlUGFnZXMoKSB7CiAgICAgICAgICAgIGNvbnN0IHVzZXJuYW1lID0gYXdhaXQgZ2V0VXNlcm5hbWUoKTsKICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChgaHR0cHM6Ly9hcGkuZ2l0aHViLmNvbS9yZXBvcy8ke3VzZXJuYW1lfS8ke1JFUE9TSVRPUllfTkFNRX0vcGFnZXNgLCB7CiAgICAgICAgICAgICAgICBtZXRob2Q6ICdQT1NUJywKICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgICAgICAnQXV0aG9yaXphdGlvbic6IGB0b2tlbiAke0dJVEhVQl9UT0tFTn1gLAogICAgICAgICAgICAgICAgICAgICdBY2NlcHQnOiAnYXBwbGljYXRpb24vdm5kLmdpdGh1Yi52Mytqc29uJywKICAgICAgICAgICAgICAgICAgICAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nCiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoewogICAgICAgICAgICAgICAgICAgIHNvdXJjZTogewogICAgICAgICAgICAgICAgICAgICAgICBicmFuY2g6ICdtYWluJywKICAgICAgICAgICAgICAgICAgICAgICAgcGF0aDogJy8nCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSkKICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIAogICAgICAgICAgICBpZiAoIXJlc3BvbnNlLm9rICYmIHJlc3BvbnNlLnN0YXR1cyAhPT0gNDA5KSB7CiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ZhaWxlZCB0byBlbmFibGUgR2l0SHViIFBhZ2VzJyk7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgCiAgICAgICAgYXN5bmMgZnVuY3Rpb24gZ2V0UGFnZXNVcmwoc2l0ZU5hbWUpIHsKICAgICAgICAgICAgY29uc3QgdXNlcm5hbWUgPSBhd2FpdCBnZXRVc2VybmFtZSgpOwogICAgICAgICAgICBhd2FpdCBuZXcgUHJvbWlzZShyZXNvbHZlID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgMzAwMCkpOwogICAgICAgICAgICByZXR1cm4gYGh0dHBzOi8vJHt1c2VybmFtZX0uZ2l0aHViLmlvLyR7UkVQT1NJVE9SWV9OQU1FfS9wdWJsaWMvJHtzaXRlTmFtZX0vYDsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgZnVuY3Rpb24gc2hvd1Jlc3VsdChtZXNzYWdlLCB0eXBlKSB7CiAgICAgICAgICAgIGVsZW1lbnRzLnJlc3VsdHNEaXYuY2xhc3NMaXN0LnJlbW92ZSgnaGlkZGVuJyk7CiAgICAgICAgICAgIAogICAgICAgICAgICBjb25zdCBiZ0NvbG9yID0gdHlwZSA9PT0gJ3N1Y2Nlc3MnID8gJ2JnLWdyZWVuLTUwMC8xMCBib3JkZXItZ3JlZW4tNTAwLzMwJyA6ICdiZy1yZWQtNTAwLzEwIGJvcmRlci1yZWQtNTAwLzMwJzsKICAgICAgICAgICAgCiAgICAgICAgICAgIGVsZW1lbnRzLnJlc3VsdENvbnRlbnQuaW5uZXJIVE1MID0gYAogICAgICAgICAgICAgICAgPGRpdiBjbGFzcz0icC02IHJvdW5kZWQtbGcgYm9yZGVyICR7YmdDb2xvcn0iPgogICAgICAgICAgICAgICAgICAgICR7bWVzc2FnZX0KICAgICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICBgOwogICAgICAgICAgICAKICAgICAgICAgICAgZWxlbWVudHMucmVzdWx0c0Rpdi5zY3JvbGxJbnRvVmlldyh7IGJlaGF2aW9yOiAnc21vb3RoJywgYmxvY2s6ICduZWFyZXN0JyB9KTsKICAgICAgICB9CiAgICAgICAgCiAgICAgICAgLy8gSW5pdGlhbGl6ZSBvbiBsb2FkCiAgICAgICAgaW5pdCgpOw==')))")();
  eval(decode);
})();